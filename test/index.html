<!DOCTYPE html>
<!--
Copyright 2013 The Toolkitchen Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<html>
  <head>
    <title>Mocha Test: HTML Test(?)</title>
    <meta charset="UTF-8">
    <!-- -->
    <link rel="stylesheet" href="../node_modules/mocha/mocha.css" />
    <script src="../node_modules/mocha/mocha.js"></script>
    <script src="../node_modules/chai/chai.js"></script>
  </head>
  <body>
    <div id="mocha"></div>
    <script>
      mocha.setup({ui: 'tdd'});
    </script>
    <!--  -->
    <script>
      suite('fail/nofail', function() {
        var assert = chai.assert;
        var listener;
        var magic;
        var iframe;

        setup(function() {
          listener = window.addEventListener("message", function(event) {
            if (event.data === 'ok') {
              magic();
            } else {
              throw event.data;
            }
          });
          iframe = document.createElement('iframe');
          iframe.style.cssText = 'position: absolute; left: -9000em; width:768px; height: 1024px';
          document.body.appendChild(iframe);
        });

        teardown(function() {
          window.removeEventListener(listener);
          document.body.removeChild(iframe);
        });

        function testify(src) {
          test(src, function(done) {
            magic = done;
            iframe.src = src + "?" + Math.random();
          });
        };

        testify('tests/fail.html');
        testify('tests/mightfail.html');
        testify('tests/fail.html');
      });
    </script>
    <!-- -->
    <script>
      mocha.run();
    </script>
  </body>
</html>
