var SideTable;if(typeof WeakMap!=="undefined"&&navigator.userAgent.indexOf("Firefox/")<0){SideTable=WeakMap}else{(function(){var defineProperty=Object.defineProperty;var hasOwnProperty=Object.hasOwnProperty;var counter=(new Date).getTime()%1e9;SideTable=function(){this.name="__st"+(Math.random()*1e9>>>0)+(counter++ +"__")};SideTable.prototype={set:function(key,value){defineProperty(key,this.name,{value:value,writable:true})},get:function(key){return hasOwnProperty.call(key,this.name)?key[this.name]:undefined}}})()}var ShadowDOMPolyfill={};(function(scope){"use strict";var wrapperTable=new SideTable;var constructorTable=new SideTable;function assert(b){if(!b)throw new Error("Assertion failed")}function mixin(to,from){Object.getOwnPropertyNames(from).forEach(function(name){Object.defineProperty(to,name,Object.getOwnPropertyDescriptor(from,name))});return to}function mixinStatics(to,from){Object.getOwnPropertyNames(from).forEach(function(name){switch(name){case"arguments":case"caller":case"length":case"name":case"prototype":return}Object.defineProperty(to,name,Object.getOwnPropertyDescriptor(from,name))});return to}Object.getOwnPropertyNames(window);function getWrapperConstructor(node){var nativePrototype=node.__proto__||Object.getPrototypeOf(node);var wrapperConstructor=constructorTable.get(nativePrototype);if(wrapperConstructor)return wrapperConstructor;var parentWrapperConstructor=getWrapperConstructor(nativePrototype);var GeneratedWrapper=createWrapperConstructor(parentWrapperConstructor);registerInternal(nativePrototype,GeneratedWrapper,node);return GeneratedWrapper}function addForwardingProperties(nativePrototype,wrapperPrototype){installProperty(nativePrototype,wrapperPrototype,true)}function registerInstanceProperties(wrapperPrototype,instanceObject){installProperty(instanceObject,wrapperPrototype,false)}var isFirefox=/Firefox/.test(navigator.userAgent);var dummyDescriptor={get:function(){},set:function(v){},configurable:true,enumerable:true};function installProperty(source,target,allowMethod){Object.getOwnPropertyNames(source).forEach(function(name){if(name in target)return;if(isFirefox){source.__lookupGetter__(name)}var descriptor;try{descriptor=Object.getOwnPropertyDescriptor(source,name)}catch(ex){descriptor=dummyDescriptor}var getter,setter;if(allowMethod&&typeof descriptor.value==="function"){target[name]=function(){return this.impl[name].apply(this.impl,arguments)};return}getter=function(){return this.impl[name]};if(descriptor.writable||descriptor.set){setter=function(value){this.impl[name]=value}}Object.defineProperty(target,name,{get:getter,set:setter,configurable:descriptor.configurable,enumerable:descriptor.enumerable})})}function register(nativeConstructor,wrapperConstructor,opt_instance){var nativePrototype=nativeConstructor.prototype;registerInternal(nativePrototype,wrapperConstructor,opt_instance);mixinStatics(wrapperConstructor,nativeConstructor)}function registerInternal(nativePrototype,wrapperConstructor,opt_instance){var wrapperPrototype=wrapperConstructor.prototype;assert(constructorTable.get(nativePrototype)===undefined);constructorTable.set(nativePrototype,wrapperConstructor);addForwardingProperties(nativePrototype,wrapperPrototype);if(opt_instance)registerInstanceProperties(wrapperPrototype,opt_instance)}function isWrapperFor(wrapperConstructor,nativeConstructor){return constructorTable.get(nativeConstructor.prototype)===wrapperConstructor}function registerObject(object){var nativePrototype=Object.getPrototypeOf(object);var superWrapperConstructor=getWrapperConstructor(nativePrototype);var GeneratedWrapper=createWrapperConstructor(superWrapperConstructor);registerInternal(nativePrototype,GeneratedWrapper,object);return GeneratedWrapper}function createWrapperConstructor(superWrapperConstructor){function GeneratedWrapper(node){superWrapperConstructor.call(this,node)}GeneratedWrapper.prototype=Object.create(superWrapperConstructor.prototype);GeneratedWrapper.prototype.constructor=GeneratedWrapper;return GeneratedWrapper}var OriginalNode=Node;var OriginalEvent=Event;function wrap(node){if(node===null)return null;assert(node instanceof OriginalNode||node instanceof OriginalEvent);var wrapper=wrapperTable.get(node);if(!wrapper){var wrapperConstructor=getWrapperConstructor(node);wrapper=new wrapperConstructor(node);wrapperTable.set(node,wrapper)}return wrapper}function unwrap(wrapper){if(wrapper===null)return null;assert(wrapper instanceof scope.WrapperEventTarget||wrapper instanceof scope.WrapperEvent);return wrapper.impl}function rewrap(node,wrapper){if(wrapper===null)return;assert(node instanceof OriginalNode||node instanceof OriginalEvent);assert(wrapper===undefined||wrapper instanceof scope.WrapperNode);wrapperTable.set(node,wrapper)}function addWrapGetter(wrapperConstructor,name){Object.defineProperty(wrapperConstructor.prototype,name,{get:function(){return wrap(this.impl[name])},configurable:true,enumerable:true})}scope.addWrapGetter=addWrapGetter;scope.assert=assert;scope.mixin=mixin;scope.registerObject=registerObject;scope.registerWrapper=register;scope.rewrap=rewrap;scope.unwrap=unwrap;scope.wrap=wrap;scope.isWrapperFor=isWrapperFor})(this.ShadowDOMPolyfill);(function(scope){"use strict";var mixin=scope.mixin;var unwrap=scope.unwrap;var wrap=scope.wrap;var registerWrapper=scope.registerWrapper;var wrappers=scope.wrappers;var wrappedFuns=new SideTable;var listenersTable=new SideTable;var handledEventsTable=new SideTable;var targetTable=new SideTable;var currentTargetTable=new SideTable;var relatedTargetTable=new SideTable;var eventPhaseTable=new SideTable;var stopPropagationTable=new SideTable;var stopImmediatePropagationTable=new SideTable;function isShadowRoot(node){return node instanceof scope.WrapperShadowRoot}function isInsertionPoint(node){var localName=node.localName;return localName==="content"||localName==="shadow"}function isShadowHost(node){return!!node.shadowRoot}function calculateParent(node,context){if(isShadowRoot(node))return node.insertionPointParent||scope.getHostForShadowRoot(node);var p=node.insertionPointParent;if(p)return p;if(context&&isInsertionPoint(node)){var parentNode=node.parentNode;if(parentNode&&isShadowHost(parentNode)){var trees=getShadowTrees(parentNode);var p=context.insertionPointParent;for(var i=0;i<trees.length;i++){if(trees[i].contains(p))return p}}}return node.parentNode}function retarget(node){var stack=[];var ancestor=node;var targets=[];while(ancestor){var context=null;if(isInsertionPoint(ancestor)){context=topMostNotInsertionPoint(stack);var top=stack[stack.length-1]||ancestor;stack.push(top)}if(!stack.length)stack.push(ancestor);var target=stack[stack.length-1];targets.push({target:target,ancestor:ancestor});if(isShadowRoot(ancestor))stack.pop();ancestor=calculateParent(ancestor,context)}return targets}function topMostNotInsertionPoint(stack){for(var i=stack.length-1;i>=0;i--){if(!isInsertionPoint(stack[i]))return stack[i]}return null}function adjustRelatedTarget(target,related){while(target){var stack=[];var ancestor=related;var last=undefined;while(ancestor){var context=null;if(!stack.length){stack.push(ancestor)}else{if(isInsertionPoint(ancestor)){context=topMostNotInsertionPoint(stack);if(isDistributed(last)){var head=stack[stack.length-1];stack.push(head)}}}if(inSameTree(ancestor,target))return stack[stack.length-1];if(isShadowRoot(ancestor))stack.pop();last=ancestor;ancestor=calculateParent(ancestor,context)}if(isShadowRoot(target))target=scope.getHostForShadowRoot(target);else target=target.parentNode}}function isDistributed(node){return node.insertionPointParent}function inSameTree(a,b){while(true){if(a===b)return a!==null;if(a)a=a.parentNode;if(b)b=b.parentNode}}function dispatchOriginalEvent(originalEvent){if(handledEventsTable.get(originalEvent))return;handledEventsTable.set(originalEvent,true);var target=wrap(originalEvent.target);var event=wrap(originalEvent);return dispatchEvent(event,target)}function dispatchEvent(event,originalWrapperTarget){var eventPath=retarget(originalWrapperTarget);if(dispatchCapturing(event,eventPath)){if(dispatchAtTarget(event,eventPath)){dispatchBubbling(event,eventPath)}}eventPhaseTable.set(event,Event.NONE);currentTargetTable.set(event,null);return event.defaultPrevented}function dispatchCapturing(event,eventPath){var phase;for(var i=eventPath.length-1;i>0;i--){var target=eventPath[i].target;var currentTarget=eventPath[i].ancestor;if(target===currentTarget)phase=Event.AT_TARGET;else phase=Event.CAPTURING_PHASE;if(!invoke(eventPath[i],event,phase))return false}return true}function dispatchAtTarget(event,eventPath){var phase=Event.AT_TARGET;return invoke(eventPath[0],event,phase)}function dispatchBubbling(event,eventPath){if(event.bubbles){var phase=Event.BUBBLING_PHASE;for(var i=1;i<eventPath.length;i++){var target=eventPath[i].target;var currentTarget=eventPath[i].ancestor;if(target===currentTarget)continue;if(!invoke(eventPath[i],event,phase))return false}}return true}function invoke(tuple,event,phase){var target=tuple.target;var currentTarget=tuple.ancestor;var listeners=listenersTable.get(currentTarget);if(!listeners)return true;if("relatedTarget"in event){var originalEvent=unwrap(event);var relatedTarget=wrap(originalEvent.relatedTarget);var adjusted=adjustRelatedTarget(currentTarget,relatedTarget);if(adjusted===target)return false;relatedTargetTable.set(event,adjusted)}eventPhaseTable.set(event,phase);var type=event.type;var anyRemoved=false;targetTable.set(event,target);currentTargetTable.set(event,currentTarget);for(var i=0;i<listeners.length;i++){var listener=listeners[i];if(listener.removed){anyRemoved=true;continue}if(listener.type!==type||!listener.capture&&phase===Event.CAPTURING_PHASE||listener.capture&&phase===Event.BUBBLING_PHASE){continue}try{if(typeof listener.handler==="function")listener.handler.call(currentTarget,event);else listener.handler.handleEvent(event);if(stopImmediatePropagationTable.get(event))return false}catch(ex){if(window.onerror)window.onerror(ex.message);else console.error(ex)}}if(anyRemoved){var copy=listeners.slice();listeners.length=0;for(var i=0;i<copy.length;i++){if(!copy[i].removed)listeners.push(copy[i])}}return!stopPropagationTable.get(event)}function Listener(type,handler,capture){this.type=type;this.handler=handler;this.capture=Boolean(capture)}Listener.prototype={equals:function(that){return this.handler===that.handler&&this.type===that.type&&this.capture===that.capture},get removed(){return this.handler===null},remove:function(){this.handler=null}};var OriginalEvent=Event;var WrapperEvent=function Event(type,options){if(type instanceof OriginalEvent)this.impl=type;else this.impl=new OriginalEvent(type,options)};WrapperEvent.prototype={get target(){return targetTable.get(this)},get currentTarget(){return currentTargetTable.get(this)},get eventPhase(){return eventPhaseTable.get(this)},stopPropagation:function(){stopPropagationTable.set(this,true)},stopImmediatePropagation:function(){stopPropagationTable.set(this,true);stopImmediatePropagationTable.set(this,true)}};registerWrapper(Event,WrapperEvent,document.createEvent("Event"));function unwrapOptions(options){if(!options||!options.relatedTarget)return options;return Object.create(options,{relatedTarget:{value:unwrap(options.relatedTarget)}})}function registerGenericEvent(name,SuperEvent,prototype){var OriginalEvent=window[name];var GenericEvent=function(type,options){if(type instanceof OriginalEvent)this.impl=type;else this.impl=new OriginalEvent(type,unwrapOptions(options))};GenericEvent.prototype=Object.create(SuperEvent.prototype);if(prototype)mixin(GenericEvent.prototype,prototype);if(OriginalEvent)registerWrapper(OriginalEvent,GenericEvent,document.createEvent(name));return GenericEvent}var WrapperUIEvent=registerGenericEvent("UIEvent",WrapperEvent);var WrapperCustomEvent=registerGenericEvent("CustomEvent",WrapperEvent);var relatedTargetProto={get relatedTarget(){return relatedTargetTable.get(this)||wrap(unwrap(this).relatedTarget)}};function getInitFunction(name,relatedTargetIndex){return function(){arguments[relatedTargetIndex]=unwrap(arguments[relatedTargetIndex]);var impl=unwrap(this);impl[name].apply(impl,arguments)}}var mouseEventProto=mixin({initMouseEvent:getInitFunction("initMouseEvent",14)},relatedTargetProto);var focusEventProto=mixin({initFocusEvent:getInitFunction("initFocusEvent",5)},relatedTargetProto);var WrapperMouseEvent=registerGenericEvent("MouseEvent",WrapperUIEvent,mouseEventProto);var WrapperFocusEvent=registerGenericEvent("FocusEvent",WrapperUIEvent,focusEventProto);function isValidListener(fun){if(typeof fun==="function")return true;return fun&&fun.handleEvent}var WrapperEventTarget=function EventTarget(impl){this.impl=impl};var originalAddEventListener=Element.prototype.addEventListener;var originalRemoveEventListener=Element.prototype.removeEventListener;var originalDispatchEvent=Element.prototype.dispatchEvent;function getTargetToListenAt(wrapper){if(wrapper instanceof scope.WrapperShadowRoot)wrapper=scope.getHostForShadowRoot(wrapper);return unwrap(wrapper)}WrapperEventTarget.prototype={addEventListener:function(type,fun,capture){if(!isValidListener(fun))return;var listener=new Listener(type,fun,capture);var listeners=listenersTable.get(this);if(!listeners){listeners=[];listenersTable.set(this,listeners)}else{for(var i=0;i<listeners.length;i++){if(listener.equals(listeners[i]))return}}listeners.push(listener);originalAddEventListener.call(getTargetToListenAt(this),type,dispatchOriginalEvent,true)},removeEventListener:function(type,fun,capture){capture=Boolean(capture);var listeners=listenersTable.get(this);if(!listeners)return;var count=0,found=false;for(var i=0;i<listeners.length;i++){if(listeners[i].type===type&&listeners[i].capture===capture){count++;if(listeners[i].handler===fun){found=true;listeners[i].remove()}}}if(found&&count===1){originalRemoveEventListener.call(getTargetToListenAt(this),type,dispatchOriginalEvent,true)}},dispatchEvent:function(event){return originalDispatchEvent.call(getTargetToListenAt(this),unwrap(event))}};if(typeof EventTarget!=="undefined")registerWrapper(EventTarget,WrapperEventTarget);scope.WrapperEvent=WrapperEvent;scope.WrapperEventTarget=WrapperEventTarget;scope.WrapperUIEvent=WrapperUIEvent;scope.WrapperFocusEvent=WrapperFocusEvent;scope.WrapperMouseEvent=WrapperMouseEvent;scope.adjustRelatedTarget=adjustRelatedTarget})(this.ShadowDOMPolyfill);(function(scope){"use strict";var wrap=scope.wrap;function nonEnum(obj,prop){Object.defineProperty(obj,prop,{enumerable:false})}var WrapperNodeList=function NodeList(){this.length=0;nonEnum(this,"length")};WrapperNodeList.prototype={item:function(index){return this[index]}};nonEnum(WrapperNodeList.prototype,"item");function wrapNodeList(list){var wrapperList=new WrapperNodeList;for(var i=0,length=list.length;i<length;i++){wrapperList[i]=wrap(list[i])}wrapperList.length=length;return wrapperList}function addWrapNodeListMethod(wrapperConstructor,name){wrapperConstructor.prototype[name]=function(){return wrapNodeList(this.impl[name].apply(this.impl,arguments))}}scope.WrapperNodeList=WrapperNodeList;scope.addWrapNodeListMethod=addWrapNodeListMethod;scope.wrapNodeList=wrapNodeList})(this.ShadowDOMPolyfill);(function(scope){"use strict";var WrapperEventTarget=scope.WrapperEventTarget;var WrapperNodeList=scope.WrapperNodeList;var addWrapGetter=scope.addWrapGetter;var assert=scope.assert;var mixin=scope.mixin;var registerWrapper=scope.registerWrapper;var unwrap=scope.unwrap;var wrap=scope.wrap;var wrappers=scope.wrappers;function collectNodes(node,parentNode,previousNode,nextNode){if(node.nodeType!==Node.DOCUMENT_FRAGMENT_NODE){if(node.parentNode)node.parentNode.removeChild(node);node.parentNode_=parentNode;node.previousSibling_=previousNode;node.nextSibling_=nextNode;if(previousNode)previousNode.nextSibling_=node;if(nextNode)nextNode.previousSibling_=node;return[node]}var nodes=[];var firstChild;while(firstChild=node.firstChild){node.removeChild(firstChild);nodes.push(firstChild);firstChild.parentNode_=parentNode}for(var i=0;i<nodes.length;i++){nodes[i].previousSibling_=nodes[i-1]||previousNode;nodes[i].nextSibling_=nodes[i+1]||nextNode}if(previousNode)previousNode.nextSibling_=nodes[0];if(nextNode)nextNode.previousSibling_=nodes[nodes.length-1];return nodes}function unwrapNodesForInsertion(nodes){if(nodes.length===1)return unwrap(nodes[0]);var df=unwrap(document.createDocumentFragment());for(var i=0;i<nodes.length;i++){df.appendChild(unwrap(nodes[i]))}return df}function removeAllChildNodes(wrapper){var childWrapper=wrapper.firstChild;while(childWrapper){assert(childWrapper.parentNode===wrapper);var nextSibling=childWrapper.nextSibling;var childNode=unwrap(childWrapper);childWrapper.previousSibling_=childWrapper.nextSibling_=childWrapper.parentNode_=null;var parentNode=childNode.parentNode;if(parentNode)parentNode.removeChild(childNode);childWrapper=nextSibling}wrapper.firstChild_=wrapper.lastChild_=null}var OriginalNode=Node;var WrapperNode=function Node(original){assert(original instanceof OriginalNode);WrapperEventTarget.call(this,original);this.parentNode_=undefined;this.firstChild_=undefined;this.lastChild_=undefined;this.nextSibling_=undefined;this.previousSibling_=undefined};WrapperNode.prototype=Object.create(WrapperEventTarget.prototype);mixin(WrapperNode.prototype,{appendChild:function(childWrapper){assert(childWrapper instanceof WrapperNode);this.invalidateShadowRenderer();var previousNode=this.lastChild;var nextNode=null;var nodes=collectNodes(childWrapper,this,previousNode,nextNode);this.lastChild_=nodes[nodes.length-1];if(!previousNode)this.firstChild_=nodes[0];this.impl.appendChild(unwrapNodesForInsertion(nodes));return childWrapper},insertBefore:function(childWrapper,refWrapper){if(!refWrapper)return this.appendChild(childWrapper);assert(childWrapper instanceof WrapperNode);assert(refWrapper instanceof WrapperNode);assert(refWrapper.parentNode===this);this.invalidateShadowRenderer();var previousNode=refWrapper.previousSibling;var nextNode=refWrapper;var nodes=collectNodes(childWrapper,this,previousNode,nextNode);if(this.firstChild===refWrapper)this.firstChild_=nodes[0];var refNode=unwrap(refWrapper);var parentNode=refNode.parentNode;if(parentNode)parentNode.insertBefore(unwrapNodesForInsertion(nodes),refNode);return childWrapper},removeChild:function(childWrapper){assert(childWrapper instanceof WrapperNode);if(childWrapper.parentNode!==this){throw new Error("NotFoundError")}this.invalidateShadowRenderer();if(this.firstChild===childWrapper)this.firstChild_=childWrapper.nextSibling;if(this.lastChild===childWrapper)this.lastChild_=childWrapper.previousSibling;if(childWrapper.previousSibling)childWrapper.previousSibling.nextSibling_=childWrapper.nextSibling;if(childWrapper.nextSibling)childWrapper.nextSibling.previousSibling_=childWrapper.previousSibling;childWrapper.previousSibling_=childWrapper.nextSibling_=childWrapper.parentNode_=null;var childNode=unwrap(childWrapper);var parentNode=childNode.parentNode;if(parentNode)parentNode.removeChild(childNode);return childWrapper},replaceChild:function(newChildWrapper,oldChildWrapper){assert(newChildWrapper instanceof WrapperNode);assert(oldChildWrapper instanceof WrapperNode);if(oldChildWrapper.parentNode!==this){throw new Error("NotFoundError")}this.invalidateShadowRenderer();var previousNode=oldChildWrapper.previousSibling;var nextNode=oldChildWrapper.nextSibling;if(nextNode===newChildWrapper)nextNode=newChildWrapper.nextSibling;var nodes=collectNodes(newChildWrapper,this,previousNode,nextNode);if(this.firstChild===oldChildWrapper)this.firstChild_=nodes[0];if(this.lastChild===oldChildWrapper)this.lastChild_=nodes[nodes.length-1];oldChildWrapper.previousSibling_=null;oldChildWrapper.nextSibling_=null;oldChildWrapper.parentNode_=null;var oldChildNode=unwrap(oldChildWrapper);if(oldChildNode.parentNode){oldChildNode.parentNode.replaceChild(unwrapNodesForInsertion(nodes),oldChildNode)}return oldChildWrapper},hasChildNodes:function(){return this.firstChild===null},get parentNode(){return this.parentNode_!==undefined?this.parentNode_:wrap(this.impl.parentNode)},get firstChild(){return this.firstChild_!==undefined?this.firstChild_:wrap(this.impl.firstChild)},get lastChild(){return this.lastChild_!==undefined?this.lastChild_:wrap(this.impl.lastChild)},get nextSibling(){return this.nextSibling_!==undefined?this.nextSibling_:wrap(this.impl.nextSibling)},get previousSibling(){return this.previousSibling_!==undefined?this.previousSibling_:wrap(this.impl.previousSibling)},get parentElement(){var p=this.parentNode;while(p&&p.nodeType!==Node.ELEMENT_NODE){p=p.parentNode}return p},get textContent(){var s="";for(var child=this.firstChild;child;child=child.nextSibling){s+=child.textContent}return s},set textContent(textContent){removeAllChildNodes(this);this.invalidateShadowRenderer();if(textContent!==""){var textNode=this.impl.ownerDocument.createTextNode(textContent);this.appendChild(textNode)}},get childNodes(){var wrapperList=new WrapperNodeList;var i=0;for(var child=this.firstChild;child;child=child.nextSibling){wrapperList[i++]=child}wrapperList.length=i;return wrapperList},cloneNode:function(deep){if(!this.invalidateShadowRenderer())return wrap(this.impl.cloneNode(deep));var clone=wrap(this.impl.cloneNode(false));if(deep){for(var child=this.firstChild;child;child=child.nextSibling){clone.appendChild(child.cloneNode(true))}}return clone},contains:function(child){if(child===this)return true;var parentNode=child.parentNode;if(!parentNode)return false;return this.contains(parentNode)}});addWrapGetter(WrapperNode,"ownerDocument");registerWrapper(Node,WrapperNode,document.createDocumentFragment());delete WrapperNode.prototype.querySelector;delete WrapperNode.prototype.querySelectorAll;WrapperNode.prototype=mixin(Object.create(WrapperEventTarget.prototype),WrapperNode.prototype);scope.WrapperNode=WrapperNode})(this.ShadowDOMPolyfill);(function(scope){"use strict";var WrapperNodeList=scope.WrapperNodeList;var mixin=scope.mixin;var wrap=scope.wrap;var wrapNodeList=scope.wrapNodeList;function forwardElement(node){while(node&&node.nodeType!==Node.ELEMENT_NODE){node=node.nextSibling}return node}function backwardsElement(node){while(node&&node.nodeType!==Node.ELEMENT_NODE){node=node.previousSibling}return node}var ParentNodeInterface={get firstElementChild(){return forwardElement(this.firstChild)},get lastElementChild(){return backwardsElement(this.lastChild)},get childElementCount(){var count=0;for(var child=this.firstElementChild;child;child=child.nextElementSibling){count++}return count},get children(){var wrapperList=new WrapperNodeList;var i=0;for(var child=this.firstElementChild;child;child=child.nextElementSibling){wrapperList[i++]=child}wrapperList.length=i;return wrapperList}};var ChildNodeInterface={get nextElementSibling(){return forwardElement(this.nextSibling)},get previousElementSibling(){return backwardsElement(this.nextSibling)}};var SelectorsInterface={querySelector:function(s){return wrap(this.impl.querySelector(s))},querySelectorAll:function(s){return wrapNodeList(this.impl.querySelectorAll(s))}};scope.ChildNodeInterface=ChildNodeInterface;scope.ParentNodeInterface=ParentNodeInterface;scope.SelectorsInterface=SelectorsInterface})(this.ShadowDOMPolyfill);(function(scope){"use strict";var ChildNodeInterface=scope.ChildNodeInterface;var WrapperNode=scope.WrapperNode;var mixin=scope.mixin;var registerWrapper=scope.registerWrapper;var WrapperCharacterData=function CharacterData(node){WrapperNode.call(this,node)};WrapperCharacterData.prototype=Object.create(WrapperNode.prototype);mixin(WrapperCharacterData.prototype,{get textContent(){return this.data},set textContent(value){this.data=value}});mixin(WrapperCharacterData.prototype,ChildNodeInterface);registerWrapper(CharacterData,WrapperCharacterData,document.createTextNode(""));scope.WrapperCharacterData=WrapperCharacterData})(this.ShadowDOMPolyfill);(function(scope){"use strict";var ChildNodeInterface=scope.ChildNodeInterface;var ParentNodeInterface=scope.ParentNodeInterface;var SelectorsInterface=scope.SelectorsInterface;var WrapperNode=scope.WrapperNode;var addWrapNodeListMethod=scope.addWrapNodeListMethod;var mixin=scope.mixin;var registerWrapper=scope.registerWrapper;var wrappers=scope.wrappers;var shadowRootTable=new SideTable;var WrapperElement=function Element(node){WrapperNode.call(this,node)};WrapperElement.prototype=Object.create(WrapperNode.prototype);mixin(WrapperElement.prototype,{createShadowRoot:function(){var newShadowRoot=new scope.WrapperShadowRoot(this);shadowRootTable.set(this,newShadowRoot);var renderer=new scope.ShadowRenderer(this);this.invalidateShadowRenderer();return newShadowRoot},get shadowRoot(){return shadowRootTable.get(this)||null},setAttribute:function(name,value){this.impl.setAttribute(name,value);this.invalidateShadowRenderer()}});mixin(WrapperElement.prototype,ChildNodeInterface);mixin(WrapperElement.prototype,ParentNodeInterface);mixin(WrapperElement.prototype,SelectorsInterface);["getElementsByTagName","getElementsByTagNameNS","getElementsByClassName"].forEach(function(name){addWrapNodeListMethod(WrapperElement,name)});registerWrapper(Element,WrapperElement);scope.WrapperElement=WrapperElement})(this.ShadowDOMPolyfill);(function(scope){"use strict";var WrapperElement=scope.WrapperElement;var mixin=scope.mixin;var unwrap=scope.unwrap;var wrap=scope.wrap;var registerWrapper=scope.registerWrapper;var escapeRegExp=/&|<|"/g;function escapeReplace(c){switch(c){case"&":return"&amp;";case"<":return"&lt;";case'"':return"&quot;"}}function escape(s){return s.replace(escapeRegExp,escapeReplace)}var voidElements={area:true,base:true,br:true,col:true,command:true,embed:true,hr:true,img:true,input:true,keygen:true,link:true,meta:true,param:true,source:true,track:true,wbr:true};function getOuterHTML(node){switch(node.nodeType){case Node.ELEMENT_NODE:var tagName=node.tagName.toLowerCase();var s="<"+tagName;var attrs=node.attributes;for(var i=0,attr;attr=attrs[i];i++){s+=" "+attr.name+'="'+escape(attr.value)+'"'}s+=">";if(voidElements[tagName])return s;return s+getInnerHTML(node)+"</"+tagName+">";case Node.TEXT_NODE:return escape(node.nodeValue);case Node.COMMENT_NODE:return"<!--"+escape(node.nodeValue)+"-->";default:console.error(node);throw new Error("not implemented")}}function getInnerHTML(node){var s="";for(var child=node.firstChild;child;child=child.nextSibling){s+=getOuterHTML(child)}return s}function setInnerHTML(node,value,opt_tagName){var tagName=opt_tagName||"div";node.textContent="";var tempElement=unwrap(node.ownerDocument.createElement(tagName));tempElement.innerHTML=value;var firstChild;while(firstChild=tempElement.firstChild){node.appendChild(wrap(firstChild))}}var WrapperHTMLElement=function HTMLElement(node){WrapperElement.call(this,node)};WrapperHTMLElement.prototype=Object.create(WrapperElement.prototype);mixin(WrapperHTMLElement.prototype,{get innerHTML(){return getInnerHTML(this)},set innerHTML(value){setInnerHTML(this,value,this.tagName)},get outerHTML(){return getOuterHTML(this)},set outerHTML(value){if(!this.invalidateShadowRenderer()){this.impl.outerHTML=value}else{throw new Error("not implemented")}}});function getterRequiresRendering(name){Object.defineProperty(WrapperHTMLElement.prototype,name,{get:function(){scope.renderAllPending();return this.impl[name]},configurable:true,enumerable:true})}["clientHeight","clientLeft","clientTop","clientWidth","offsetHeight","offsetLeft","offsetTop","offsetWidth","scrollHeight","scrollLeft","scrollTop","scrollWidth"].forEach(getterRequiresRendering);function methodRequiresRendering(name){Object.defineProperty(WrapperHTMLElement.prototype,name,{value:function(){scope.renderAllPending();return this.impl[name].apply(this.impl,arguments)},configurable:true,enumerable:true})}["getBoundingClientRect","getClientRects","scrollIntoView"].forEach(methodRequiresRendering);registerWrapper(HTMLElement,WrapperHTMLElement,document.createElement("b"));scope.WrapperHTMLElement=WrapperHTMLElement;scope.getInnerHTML=getInnerHTML;scope.setInnerHTML=setInnerHTML})(this.ShadowDOMPolyfill);(function(scope){"use strict";var WrapperHTMLElement=scope.WrapperHTMLElement;var mixin=scope.mixin;var registerWrapper=scope.registerWrapper;var WrapperHTMLContentElement=function HTMLContentElement(node){WrapperHTMLElement.call(this,node)};WrapperHTMLContentElement.prototype=Object.create(WrapperHTMLElement.prototype);mixin(WrapperHTMLContentElement.prototype,{get select(){return this.getAttribute("select")},set select(value){this.setAttribute("select",value);this.invalidateShadowRenderer()}});if(typeof HTMLContentElement!=="undefined")registerWrapper(HTMLContentElement,WrapperHTMLContentElement);scope.WrapperHTMLContentElement=WrapperHTMLContentElement})(this.ShadowDOMPolyfill);(function(scope){"use strict";var WrapperHTMLElement=scope.WrapperHTMLElement;var mixin=scope.mixin;var registerWrapper=scope.registerWrapper;var WrapperHTMLShadowElement=function HTMLShadowElement(node){WrapperHTMLElement.call(this,node);this.olderShadowRoot_=null};WrapperHTMLShadowElement.prototype=Object.create(WrapperHTMLElement.prototype);mixin(WrapperHTMLShadowElement.prototype,{get olderShadowRoot(){return this.olderShadowRoot_}});if(typeof HTMLShadowElement!=="undefined")registerWrapper(HTMLShadowElement,WrapperHTMLShadowElement);scope.WrapperHTMLShadowElement=WrapperHTMLShadowElement})(this.ShadowDOMPolyfill);(function(scope){"use strict";var WrapperHTMLElement=scope.WrapperHTMLElement;var getInnerHTML=scope.getInnerHTML;var mixin=scope.mixin;var setInnerHTML=scope.setInnerHTML;var wrap=scope.wrap;var registerWrapper=scope.registerWrapper;var hasNative=typeof HTMLTemplateElement!=="undefined";var contentTable=new SideTable;var templateContentsOwnerTable=new SideTable;function getTemplateContentsOwner(doc){if(!doc.defaultView)return doc;var d=templateContentsOwnerTable.get(doc);if(!d){d=doc.implementation.createHTMLDocument("");while(d.lastChild){d.removeChild(d.lastChild)}templateContentsOwnerTable.set(doc,d)}return d}function extractContent(templateElement){var doc=getTemplateContentsOwner(templateElement.ownerDocument);var df=doc.createDocumentFragment();var nextSibling;var child;while(child=templateElement.firstChild){df.appendChild(child)}return df}var WrapperHTMLTemplateElement=function HTMLTemplateElement(node){WrapperHTMLElement.call(this,node)};WrapperHTMLTemplateElement.prototype=Object.create(WrapperHTMLElement.prototype);mixin(WrapperHTMLTemplateElement.prototype,{get content(){if(hasNative)return wrap(this.impl.content);var content=contentTable.get(this);if(!content){content=extractContent(this);contentTable.set(this,content)}return content},get innerHTML(){return getInnerHTML(this.content)},set innerHTML(value){setInnerHTML(this.content,value);this.invalidateShadowRenderer()}});if(hasNative)registerWrapper(HTMLTemplateElement,WrapperHTMLTemplateElement);scope.WrapperHTMLTemplateElement=WrapperHTMLTemplateElement})(this.ShadowDOMPolyfill);(function(scope){"use strict";var WrapperHTMLContentElement=scope.WrapperHTMLContentElement;var WrapperHTMLElement=scope.WrapperHTMLElement;var WrapperHTMLShadowElement=scope.WrapperHTMLShadowElement;var WrapperHTMLTemplateElement=scope.WrapperHTMLTemplateElement;var mixin=scope.mixin;var registerWrapper=scope.registerWrapper;var WrapperHTMLUnknownElement=function HTMLUnknownElement(node){switch(node.localName){case"content":return new WrapperHTMLContentElement(node);case"shadow":return new WrapperHTMLShadowElement(node);case"template":return new WrapperHTMLTemplateElement(node)}WrapperHTMLElement.call(this,node)};WrapperHTMLUnknownElement.prototype=Object.create(WrapperHTMLElement.prototype);registerWrapper(HTMLUnknownElement,WrapperHTMLUnknownElement);scope.WrapperHTMLUnknownElement=WrapperHTMLUnknownElement})(this.ShadowDOMPolyfill);(function(scope){"use strict";var ParentNodeInterface=scope.ParentNodeInterface;var SelectorsInterface=scope.SelectorsInterface;var mixin=scope.mixin;var registerObject=scope.registerObject;
var WrapperDocumentFragment=registerObject(document.createDocumentFragment());mixin(WrapperDocumentFragment.prototype,ParentNodeInterface);mixin(WrapperDocumentFragment.prototype,SelectorsInterface);registerObject(document.createTextNode(""));registerObject(document.createComment(""));scope.WrapperDocumentFragment=WrapperDocumentFragment})(this.ShadowDOMPolyfill);(function(scope){"use strict";var WrapperDocumentFragment=scope.WrapperDocumentFragment;var getInnerHTML=scope.getInnerHTML;var mixin=scope.mixin;var rewrap=scope.rewrap;var setInnerHTML=scope.setInnerHTML;var unwrap=scope.unwrap;var shadowHostTable=new SideTable;var WrapperShadowRoot=function ShadowRoot(hostWrapper){var node=unwrap(hostWrapper.impl.ownerDocument.createDocumentFragment());WrapperDocumentFragment.call(this,node);rewrap(node,this);var oldShadowRoot=hostWrapper.shadowRoot;scope.nextOlderShadowTreeTable.set(this,oldShadowRoot);shadowHostTable.set(this,hostWrapper);hostWrapper.invalidateShadowRenderer()};WrapperShadowRoot.prototype=Object.create(WrapperDocumentFragment.prototype);mixin(WrapperShadowRoot.prototype,{get innerHTML(){return getInnerHTML(this)},set innerHTML(value){setInnerHTML(this,value);this.invalidateShadowRenderer()},invalidateShadowRenderer:function(){return shadowHostTable.get(this).invalidateShadowRenderer()}});scope.WrapperShadowRoot=WrapperShadowRoot;scope.getHostForShadowRoot=function(node){return shadowHostTable.get(node)}})(this.ShadowDOMPolyfill);(function(scope){"use strict";var WrapperHTMLContentElement=scope.WrapperHTMLContentElement;var WrapperNode=scope.WrapperNode;var assert=scope.assert;var mixin=scope.mixin;var unwrap=scope.unwrap;var wrap=scope.wrap;function updateWrapperUpAndSideways(wrapper){wrapper.previousSibling_=wrapper.previousSibling;wrapper.nextSibling_=wrapper.nextSibling;wrapper.parentNode_=wrapper.parentNode}function updateWrapperDown(wrapper){wrapper.firstChild_=wrapper.firstChild;wrapper.lastChild_=wrapper.lastChild}function updateAllChildNodes(parentNodeWrapper){assert(parentNodeWrapper instanceof WrapperNode);for(var childWrapper=parentNodeWrapper.firstChild;childWrapper;childWrapper=childWrapper.nextSibling){updateWrapperUpAndSideways(childWrapper)}updateWrapperDown(parentNodeWrapper)}function removeAllChildNodes(parentNodeWrapper){var parentNode=unwrap(parentNodeWrapper);updateAllChildNodes(parentNodeWrapper);parentNode.textContent=""}function appendChild(parentNodeWrapper,childWrapper){var parentNode=unwrap(parentNodeWrapper);var child=unwrap(childWrapper);if(child.nodeType===Node.DOCUMENT_FRAGMENT_NODE){updateAllChildNodes(childWrapper)}else{remove(childWrapper);updateWrapperUpAndSideways(childWrapper)}parentNodeWrapper.lastChild_=parentNodeWrapper.lastChild;if(parentNodeWrapper.lastChild===parentNodeWrapper.firstChild)parentNodeWrapper.firstChild_=parentNodeWrapper.firstChild;var lastChildWrapper=wrap(parentNode.lastChild);if(lastChildWrapper){lastChildWrapper.nextSibling_=lastChildWrapper.nextSibling}parentNode.appendChild(child)}function removeChild(parentNodeWrapper,childWrapper){var parentNode=unwrap(parentNodeWrapper);var child=unwrap(childWrapper);updateWrapperUpAndSideways(childWrapper);if(childWrapper.previousSibling)childWrapper.previousSibling.nextSibling_=childWrapper;if(childWrapper.nextSibling)childWrapper.nextSibling.previousSibling_=childWrapper;if(parentNodeWrapper.lastChild===childWrapper)parentNodeWrapper.lastChild_=childWrapper;if(parentNodeWrapper.firstChild===childWrapper)parentNodeWrapper.firstChild_=childWrapper;parentNode.removeChild(child)}function remove(nodeWrapper){var node=unwrap(nodeWrapper);var parentNode=node.parentNode;if(parentNode)removeChild(wrap(parentNode),nodeWrapper)}var distributedChildNodesTable=new SideTable;var shadowDOMRendererTable=new SideTable;var nextOlderShadowTreeTable=new SideTable;var insertionPointParentTable=new SideTable;function distributeChildToInsertionPoint(child,insertionPoint){getDistributedChildNodes(insertionPoint).push(child);insertionPointParentTable.set(child,insertionPoint)}function resetDistributedChildNodes(insertionPoint){distributedChildNodesTable.set(insertionPoint,[])}function getDistributedChildNodes(insertionPoint){return distributedChildNodesTable.get(insertionPoint)}function getChildNodesSnapshot(node){var result=[],i=0;for(var child=node.firstChild;child;child=child.nextSibling){result[i++]=child}return result}function visit(tree,predicate,visitor){var nodes=getChildNodesSnapshot(tree);for(var i=0;i<nodes.length;i++){var node=nodes[i];if(predicate(node)){if(visitor(node)===false)return}else{visit(node,predicate,visitor)}}}function distribute(tree,pool){var anyRemoved=false;visit(tree,isActiveInsertionPoint,function(insertionPoint){resetDistributedChildNodes(insertionPoint);for(var i=0;i<pool.length;i++){var node=pool[i];if(node===undefined)continue;if(matchesCriteria(node,insertionPoint)){distributeChildToInsertionPoint(node,insertionPoint);pool[i]=undefined;anyRemoved=true}}});if(!anyRemoved)return pool;var newPool=[];for(var i=0;i<pool.length;i++){if(pool[i]!==undefined)newPool.push(pool[i])}return newPool}var selectorMatchRegExp=/^[*.:#[a-zA-Z_|]/;var allowedPseudoRegExp=new RegExp("^:("+["link","visited","target","enabled","disabled","checked","indeterminate","nth-child","nth-last-child","nth-of-type","nth-last-of-type","first-child","last-child","first-of-type","last-of-type","only-of-type"].join("|")+")");function oneOf(object,propertyNames){for(var i=0;i<propertyNames.length;i++){if(propertyNames[i]in object)return propertyNames[i]}}var matchesSelector=oneOf(document.documentElement,["matchesSelector","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector"]);function matchesCriteria(node,point){var select=point.getAttribute("select");if(!select)return true;select=select.trim();if(!select)return true;if(node.nodeType!==Node.ELEMENT_NODE)return false;if(!selectorMatchRegExp.test(select))return false;if(select[0]===":"&&!allowedPseudoRegExp.test(select))return false;try{return node[matchesSelector](select)}catch(ex){return false}}var request=oneOf(window,["requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","setTimeout"]);var pendingDirtyRenderers=[];var renderTimer;function renderAllPending(){renderTimer=null;pendingDirtyRenderers.forEach(function(owner){owner.render()});pendingDirtyRenderers=[]}function ShadowRenderer(host){this.host=host;this.dirty=false;this.associateNode(host)}ShadowRenderer.prototype={render:function(){if(!this.dirty)return;var host=this.host;this.treeComposition();var shadowDOM=host.shadowRoot;if(!shadowDOM)return;this.removeAllChildNodes(this.host);var shadowDOMChildNodes=getChildNodesSnapshot(shadowDOM);shadowDOMChildNodes.forEach(function(node){this.renderNode(host,shadowDOM,node,false)},this);this.dirty=false},invalidate:function(){if(!this.dirty){this.dirty=true;pendingDirtyRenderers.push(this);if(renderTimer)return;renderTimer=window[request](renderAllPending,0)}},renderNode:function(visualParent,tree,node,isNested){if(isShadowHost(node)){this.appendChild(visualParent,node);var renderer=new ShadowRenderer(node);renderer.render()}else if(isInsertionPoint(node)){this.renderInsertionPoint(visualParent,tree,node,isNested)}else if(isShadowInsertionPoint(node)){this.renderShadowInsertionPoint(visualParent,tree,node)}else{this.renderAsAnyDomTree(visualParent,tree,node,isNested)}},renderAsAnyDomTree:function(visualParent,tree,child,isNested){this.appendChild(visualParent,child);if(isShadowHost(child)){render(child)}else{var parent=child;var logicalChildNodes=getChildNodesSnapshot(parent);logicalChildNodes.forEach(function(node){this.renderNode(parent,tree,node,isNested)},this)}},renderInsertionPoint:function(visualParent,tree,insertionPoint,isNested){var distributedChildNodes=getDistributedChildNodes(insertionPoint);if(distributedChildNodes.length){this.removeAllChildNodes(insertionPoint);distributedChildNodes.forEach(function(child){if(isInsertionPoint(child)&&isNested)this.renderInsertionPoint(visualParent,tree,child,isNested);else this.renderAsAnyDomTree(visualParent,tree,child,isNested)},this)}else{this.renderFallbackContent(visualParent,insertionPoint)}this.remove(insertionPoint)},renderShadowInsertionPoint:function(visualParent,tree,shadowInsertionPoint){var nextOlderTree=getNextOlderTree(tree);if(nextOlderTree){insertionPointParentTable.set(nextOlderTree,shadowInsertionPoint);shadowInsertionPoint.olderShadowRoot_=nextOlderTree;this.remove(shadowInsertionPoint);var shadowDOMChildNodes=getChildNodesSnapshot(nextOlderTree);shadowDOMChildNodes.forEach(function(node){this.renderNode(visualParent,nextOlderTree,node,true)},this)}else{this.renderFallbackContent(visualParent,shadowInsertionPoint)}},renderFallbackContent:function(visualParent,fallbackHost){var logicalChildNodes=getChildNodesSnapshot(fallbackHost);logicalChildNodes.forEach(function(node){this.appendChild(visualParent,node)},this)},treeComposition:function(){var shadowHost=this.host;var tree=shadowHost.shadowRoot;var pool=[];var shadowHostChildNodes=getChildNodesSnapshot(shadowHost);shadowHostChildNodes.forEach(function(child){if(isInsertionPoint(child)){var reprojected=getDistributedChildNodes(child);if(!reprojected||!reprojected.length)reprojected=getChildNodesSnapshot(child);pool.push.apply(pool,reprojected)}else{pool.push(child)}});var shadowInsertionPoint,point;while(tree){shadowInsertionPoint=undefined;visit(tree,isActiveShadowInsertionPoint,function(point){shadowInsertionPoint=point;return false});point=shadowInsertionPoint;pool=distribute(tree,pool);if(point){var nextOlderTree=getNextOlderTree(tree);if(!nextOlderTree){break}else{tree=nextOlderTree;assignShadowTreeToShadowInsertionPoint(tree,point);continue}}else{break}}},appendChild:function(parent,child){appendChild(parent,child);this.associateNode(child)},remove:function(node){remove(node);this.associateNode(node)},removeAllChildNodes:function(parent){removeAllChildNodes(parent)},associateNode:function(node){shadowDOMRendererTable.set(node,this)}};function isInsertionPoint(node){return node.tagName=="CONTENT"}function isActiveInsertionPoint(node){return node.tagName==="CONTENT"}function isShadowInsertionPoint(node){return node.tagName==="SHADOW"}function isActiveShadowInsertionPoint(node){return node.tagName==="SHADOW"}function isShadowHost(shadowHost){return!!shadowHost.shadowRoot}function getNextOlderTree(tree){return nextOlderShadowTreeTable.get(tree)}function getShadowTrees(host){var trees=[];for(var tree=host.shadowRoot;tree;tree=nextOlderShadowTreeTable.get(tree)){trees.push(tree)}return trees}function assignShadowTreeToShadowInsertionPoint(tree,point){}function render(host){new ShadowRenderer(host).render()}WrapperNode.prototype.invalidateShadowRenderer=function(){var renderer=shadowDOMRendererTable.get(this);if(!renderer)return false;renderer.invalidate();return true};WrapperHTMLContentElement.prototype.getDistributedNodes=function(){renderAllPending();return getDistributedChildNodes(this)};mixin(WrapperNode.prototype,{get insertionPointParent(){return insertionPointParentTable.get(this)||null}});scope.ShadowRenderer=ShadowRenderer;scope.renderAllPending=renderAllPending;scope.nextOlderShadowTreeTable=nextOlderShadowTreeTable;scope.getShadowTrees=getShadowTrees;scope.visual={removeAllChildNodes:removeAllChildNodes,appendChild:appendChild,removeChild:removeChild}})(this.ShadowDOMPolyfill);(function(scope){"use strict";var ParentNodeInterface=scope.ParentNodeInterface;var WrapperNode=scope.WrapperNode;var addWrapGetter=scope.addWrapGetter;var mixin=scope.mixin;var unwrap=scope.unwrap;var wrap=scope.wrap;var wrapNodeList=scope.wrapNodeList;var registerWrapper=scope.registerWrapper;var implementationTable=new SideTable;var WrapperDocument=function Document(node){WrapperNode.call(this,node)};WrapperDocument.prototype=Object.create(WrapperNode.prototype);addWrapGetter(WrapperDocument,"documentElement");addWrapGetter(WrapperDocument,"body");addWrapGetter(WrapperDocument,"head");mixin(WrapperDocument.prototype,ParentNodeInterface);mixin(WrapperDocument.prototype,{get implementation(){var implementation=implementationTable.get(this);if(implementation)return implementation;implementation=new WrapperDOMImplementation(unwrap(this).implementation);implementationTable.set(this,implementation);return implementation}});registerWrapper(Document,WrapperDocument,document.implementation.createHTMLDocument(""));if(typeof HTMLDocument!=="undefined")registerWrapper(HTMLDocument,WrapperDocument);function wrapMethod(name){var proto=Object.getPrototypeOf(document);var original=proto[name];proto[name]=function(){return wrap(original.apply(this,arguments))};WrapperDocument.prototype[name]=function(){return wrap(original.apply(this.impl,arguments))}}["getElementById","querySelector","createElement","createElementNS","createTextNode","createDocumentFragment","createEvent","createEventNS"].forEach(wrapMethod);function wrapNodeListMethod(name){var proto=Object.getPrototypeOf(document);var original=proto[name];proto[name]=function(){return wrapNodeList(original.apply(this,arguments))};WrapperDocument.prototype[name]=function(){return wrapNodeList(original.apply(this.impl,arguments))}}["getElementsByTagName","getElementsByTagNameNS","getElementsByClassName","querySelectorAll"].forEach(wrapNodeListMethod);function wrapEventTargetMethod(name){var proto=Object.getPrototypeOf(document);proto[name]=function(){var wrapper=wrap(this);return wrapper[name].apply(wrapper,arguments)}}["addEventListener","removeEventListener","dispatchEvent"].forEach(wrapEventTargetMethod);function wrapImplMethod(constructor,name){constructor.prototype[name]=function(){return wrap(this.impl[name].apply(this.impl,arguments))}}function forwardImplMethod(constructor,name){constructor.prototype[name]=function(){return this.impl[name].apply(this.impl,arguments)}}var WrapperDOMImplementation=function DOMImplementation(node){this.impl=node};wrapImplMethod(WrapperDOMImplementation,"createDocumentType");wrapImplMethod(WrapperDOMImplementation,"createDocument");wrapImplMethod(WrapperDOMImplementation,"createHTMLDocument");forwardImplMethod(WrapperDOMImplementation,"hasFeature");scope.WrapperDocument=WrapperDocument})(this.ShadowDOMPolyfill);(function(scope){"use strict";var isWrapperFor=scope.isWrapperFor;Object.getOwnPropertyNames(scope).forEach(function(name){if(/^Wrapper/.test(name)){var wrapperConstructor=scope[name];var nativeConstructorName=name.slice(7);var nativeConstructor=window[nativeConstructorName];if(nativeConstructor&&isWrapperFor(wrapperConstructor,nativeConstructor)){window[nativeConstructorName]=wrapperConstructor}}});if(!window.EventTarget)window.EventTarget=scope.WrapperEventTarget;var elements={a:"HTMLAnchorElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",audio:"HTMLAudioElement",br:"HTMLBRElement",base:"HTMLBaseElement",body:"HTMLBodyElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",dl:"HTMLDListElement",datalist:"HTMLDataListElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",embed:"HTMLEmbedElement",fieldset:"HTMLFieldSetElement",font:"HTMLFontElement",form:"HTMLFormElement",frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",hr:"HTMLHRElement",head:"HTMLHeadElement",h1:"HTMLHeadingElement",html:"HTMLHtmlElement",iframe:"HTMLIFrameElement",input:"HTMLInputElement",li:"HTMLLIElement",label:"HTMLLabelElement",legend:"HTMLLegendElement",link:"HTMLLinkElement",map:"HTMLMapElement",menu:"HTMLMenuElement",menuitem:"HTMLMenuItemElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",del:"HTMLModElement",ol:"HTMLOListElement",object:"HTMLObjectElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",q:"HTMLQuoteElement",script:"HTMLScriptElement",select:"HTMLSelectElement",source:"HTMLSourceElement",span:"HTMLSpanElement",style:"HTMLStyleElement",caption:"HTMLTableCaptionElement",col:"HTMLTableColElement",table:"HTMLTableElement",tr:"HTMLTableRowElement",thead:"HTMLTableSectionElement",tbody:"HTMLTableSectionElement",textarea:"HTMLTextAreaElement",title:"HTMLTitleElement",ul:"HTMLUListElement",video:"HTMLVideoElement"};function overrideConstructor(tagName){var nativeConstructorName=elements[tagName];var nativeConstructor=window[nativeConstructorName];if(!nativeConstructor)return;var element=document.createElement(tagName);var wrapperConstructor=element.constructor;window[nativeConstructorName]=wrapperConstructor}Object.keys(elements).forEach(overrideConstructor);scope.knownElements=elements})(this.ShadowDOMPolyfill);var generateMatcher=function(inSlctr){if(!inSlctr){return}var c=inSlctr[0];if(inSlctr==="~"){return function(inNode){return Boolean(inNode.lightDOM)}}if(c==="#"){m=inSlctr.slice(1);return function(inNode){return inNode.id===m}}if(inSlctr==="*"){return function(inNode){return inNode.nodeName!=="#text"}}if(c==="."){m=inSlctr.slice(1);return function(inNode){return inNode.classList&&inNode.classList.contains(m)}}if(c==="["){m=inSlctr.slice(1,-1);return function(inNode){return inNode.hasAttribute&&inNode.hasAttribute(m)}}var slctrs=inSlctr.toLowerCase().split(",");return function(inNode){return slctrs.indexOf(inNode.localName)>=0}};var isInsertionPoint=function(inNode){return{SHADOW:1,CONTENT:1}[inNode.tagName]};var search=function(inNodes,inMatcher){var results=[];for(var i=0,n;n=inNodes[i];i++){if(inMatcher(n)){results.push(n)}if(!isInsertionPoint(n)){results=results.concat(_search(n,inMatcher))}}return results};var _search=function(inNode,inMatcher){return search(inNode.childNodes,inMatcher)};var localQueryAll=function(inNode,inSlctr){var results=search(inNode.childNodes,generateMatcher(inSlctr));return results};var localQuery=function(inNode,inSlctr){return localQueryAll(inNode,inSlctr)[0]};if(!Function.prototype.bind){Function.prototype.bind=function(scope){var self=this;var args=Array.prototype.slice.call(arguments,1);return function(){var args2=args.slice();args2.push.apply(args2,arguments);return self.apply(scope,args2)}}}(function(){"use strict";var add=DOMTokenList.prototype.add;var remove=DOMTokenList.prototype.remove;DOMTokenList.prototype.add=function(){for(var i=0;i<arguments.length;i++){add.call(this,arguments[i])}};DOMTokenList.prototype.remove=function(){for(var i=0;i<arguments.length;i++){remove.call(this,arguments[i])}};DOMTokenList.prototype.toggle=function(name,bool){if(arguments.length==1){bool=!this.contains(name)}bool?this.add(name):this.remove(name)}})();window.templateContent=window.templateContent||function(inTemplate){return inTemplate.content};if(!window.ShadowDOMPolyfill){window.wrap=function(n){return n};window.createShadowRoot=function(inElement){return inElement.webkitCreateShadowRoot()};window.templateContent=function(inTemplate){if(window.HTMLTemplateElement&&HTMLTemplateElement.bootstrap){HTMLTemplateElement.bootstrap(inTemplate)}if(!inTemplate.content&&!inTemplate._content){var frag=document.createDocumentFragment();while(inTemplate.firstChild){frag.appendChild(inTemplate.firstChild)}inTemplate._content=frag}return inTemplate.content||inTemplate._content}}else{window.wrap=ShadowDOMPolyfill.wrap;HTMLTemplateElement=ShadowDOMPolyfill.WrapperHTMLElement;(function(){var n=document.createTextNode(" ");Text=function(){};Text.prototype=Object.getPrototypeOf(n)})();(function(){var elts={HTMLButtonElement:"button"};for(var c in elts){window[c]=function(){throw"Patched Constructor"};window[c].prototype=Object.getPrototypeOf(document.createElement(elts[c]))}})();if(window.CustomEvent){var nativeCustomEvent=CustomEvent;window.CustomEvent=function(inType,inOptions){return ShadowDOMPolyfill.wrap(new nativeCustomEvent(inType,inOptions))}}var queryPropDefs={querySelector:{value:function(inSlctr){return localQuery(this,inSlctr)}},querySelectorAll:{value:function(inSlctr){return localQueryAll(this,inSlctr)}}};Object.defineProperties(HTMLElement.prototype,queryPropDefs);Object.defineProperties(ShadowDOMPolyfill.WrapperDocument.prototype,queryPropDefs);Object.defineProperties(ShadowDOMPolyfill.WrapperShadowRoot.prototype,queryPropDefs);Object.defineProperties(HTMLElement.prototype,{webkitShadowRoot:{get:function(){return this.shadowRoot}}});HTMLElement.prototype.webkitCreateShadowRoot=HTMLElement.prototype.createShadowRoot}(function(){var inspector;window.sinspect=function(inNode,inProxy){if(!inspector){inspector=window.open("","ShadowDOM Inspector",null,true);inspector.document.write(inspectorHTML);inspector.api={shadowize:shadowize}}inspect(inNode||wrap(document.body),inProxy)};var inspectorHTML=["<!DOCTYPE html>","<html>","  <head>","    <title>ShadowDOM Inspector</title>","    <style>","      body {","      }","      pre {",'        font: 9pt "Courier New", monospace;',"        line-height: 1.5em;","      }","      tag {","        color: purple;","      }","      ul {","         margin: 0;","         padding: 0;","         list-style: none;","      }","      li {","         display: inline-block;","         background-color: #f1f1f1;","         padding: 4px 6px;","         border-radius: 4px;","         margin-right: 4px;","      }","    </style>","  </head>","  <body>",'    <ul id="crumbs">',"    </ul>",'    <div id="tree"></div>',"  </body>","</html>"].join("\n");var crumbs=[];var displayCrumbs=function(){var d=inspector.document;var cb=d.querySelector("#crumbs");cb.textContent="";for(var i=0,c;c=crumbs[i];i++){var a=d.createElement("a");a.href="#";a.textContent=c.localName;a.idx=i;a.onclick=function(event){var c;while(crumbs.length>this.idx){c=crumbs.pop()}inspect(c.shadow||c,c);event.preventDefault()};cb.appendChild(d.createElement("li")).appendChild(a)}};var inspect=function(inNode,inProxy){var d=inspector.document;drillable=[];var proxy=inProxy||inNode;crumbs.push(proxy);displayCrumbs();d.body.querySelector("#tree").innerHTML="<pre>"+output(inNode,inNode.childNodes)+"</pre>"};var forEach=Array.prototype.forEach.call.bind(Array.prototype.forEach);var blacklisted={STYLE:1,SCRIPT:1,"#comment":1,TEMPLATE:1};var blacklist=function(inNode){return blacklisted[inNode.nodeName]};var output=function(inNode,inChildNodes,inIndent){if(blacklist(inNode)){return""}var indent=inIndent||"";if(inNode.localName||inNode.nodeType==11){var name=inNode.localName||"shadow-root";var info=indent+describe(inNode);{if(name=="content"){inChildNodes=inNode.getDistributedNodes()}info+="<br/>";var ind=indent+"&nbsp;&nbsp;";forEach(inChildNodes,function(n){info+=output(n,n.childNodes,ind)});info+=indent}if(!{br:1}[name]){info+="<tag>&lt;/"+name+"&gt;</tag>";info+="<br/>"}}else{var text=inNode.textContent.trim();info=text?indent+'"'+text+'"'+"<br/>":""}return info};var catTextContent=function(inChildNodes){var info="";forEach(inChildNodes,function(n){info+=n.textContent.trim()});return info};var drillable=[];var describe=function(inNode){var tag="<tag>"+"&lt;";var name=inNode.localName||"shadow-root";if(inNode.webkitShadowRoot||inNode.shadowRoot){tag+=' <button idx="'+drillable.length+'" onclick="api.shadowize.call(this)">'+name+"</button>";drillable.push(inNode)}else{tag+=name||"shadow-root"}if(inNode.attributes){forEach(inNode.attributes,function(a){tag+=" "+a.name+(a.value?'="'+a.value+'"':"")})}tag+="&gt;"+"</tag>";return tag};shadowize=function(){var idx=Number(this.attributes.idx.value);var node=drillable[idx];if(node){inspect(node.webkitShadowRoot||node.shadowRoot,node)}else{console.log("bad shadowize node");console.dir(this)}}})();(function(global){"use strict";function ArraySet(){this.entries=[]}ArraySet.prototype={add:function(key){if(this.entries.indexOf(key)>=0)return;this.entries.push(key)},"delete":function(key){var i=this.entries.indexOf(key);if(i<0)return;this.entries.splice(i,1)},first:function(){return this.entries[0]},get size(){return this.entries.length}};function UIDSet(){this.entries={};this.size=0}UIDSet.prototype={add:function(key){if(this.entries[key.__UID__]!==undefined)return;this.entries[key.__UID__]=key;this.size++},"delete":function(key){if(this.entries[key.__UID__]===undefined)return;this.entries[key.__UID__]=undefined;this.size--}};function Heap(scoreFunction,populate){this.scoreFunction=scoreFunction;this.content=populate||[];if(this.content.length)this.build()}Heap.prototype={get size(){return this.content.length},build:function(){var lastNonLeaf=Math.floor(this.content.length/2)-1;for(var i=lastNonLeaf;i>=0;i--)this.sinkDown(i)},push:function(element){this.content.push(element);this.bubbleUp(this.content.length-1)},pop:function(){var result=this.content[0];var end=this.content.pop();if(this.content.length){this.content[0]=end;this.sinkDown(0)}return result},"delete":function(element){var len=this.content.length;for(var i=0;i<len;i++){if(this.content[i]==element){var end=this.content.pop();if(i!=len-1){this.content[i]=end;if(this.scoreFunction(end)<this.scoreFunction(node))this.bubbleUp(i);else this.sinkDown(i)}return}}},bubbleUp:function(n){var element=this.content[n];while(n>0){var parentN=Math.floor((n+1)/2)-1,parent=this.content[parentN];if(this.scoreFunction(element)<=this.scoreFunction(parent))break;this.content[parentN]=element;this.content[n]=parent;n=parentN}},sinkDown:function(n){var length=this.content.length,element=this.content[n],elemScore=this.scoreFunction(element);do{var child2N=(n+1)*2;var child1N=child2N-1;var swap=null;var swapScore=elemScore;if(child1N<length){var child1=this.content[child1N],child1Score=this.scoreFunction(child1);if(child1Score>elemScore){swap=child1N;swapScore=child1Score}}if(child2N<length){var child2=this.content[child2N],child2Score=this.scoreFunction(child2);if(child2Score>swapScore)swap=child2N}if(swap!=null){this.content[n]=this.content[swap];this.content[swap]=element;n=swap}}while(swap!=null)}};function Variable(stayFunc){this.stayFunc=stayFunc;this.methods=new ArraySet}Variable.prototype={freeMethod:function(){return this.methods.first()}};function Method(constraint,variable){this.constraint=constraint;this.variable=variable}function Constraint(planner){this.planner=planner;this.methods=[]}Constraint.prototype={addMethod:function(variable){var method=new Method(this,variable);this.methods.push(method);method.__UID__=this.planner.methodUIDCounter++;return method},reset:function(){this.methods.forEach(function(method){method.variable.methods.add(method)})},remove:function(){this.methods.forEach(function(method){method.variable.methods.delete(method)})}};function Planner(){this.variables=[];this.constraints=[];this.variableUIDCounter=1;this.methodUIDCounter=1}Planner.prototype={addVariable:function(stayFunc){var variable=new Variable(stayFunc);variable.__UID__=this.variableUIDCounter++;this.variables.push(variable);return variable},addConstraint:function(){var constraint=new Constraint(this);this.constraints.push(constraint);return constraint},removeConstraint:function(constraint){var index=this.constraints.indexOf(constraint);if(index<0)return;constraint.remove();this.constraints.splice(index,1);this.constraints.forEach(function(constraint){constraint.reset()});this.variables=this.variables.filter(function(variable){return variable.methods.size})},getPlan:function(){this.variables.forEach(function(variable){variable.priority=variable.stayFunc()});this.constraints.forEach(function(constraint){constraint.reset()});var methods=[];var free=[];var overconstrained=new UIDSet;this.variables.forEach(function(variable){var methodCount=variable.methods.size;if(methodCount>1)overconstrained.add(variable);else if(methodCount==1)free.push(variable)});free=new Heap(function(variable){return variable.priority},free);while(free.size){var lowest;do{lowest=free.pop()}while(free.size&&!lowest.methods.size);if(!lowest.methods.size)break;var method=lowest.freeMethod();var constraint=method.constraint;constraint.remove();constraint.methods.forEach(function(method){var variable=method.variable;if(variable.methods.size==1){overconstrained.delete(variable);free.push(variable)}});methods.push(method)}if(overconstrained.size)return undefined;return methods.reverse()}};global.Planner=Planner})(this);(function(global){"use strict";var hasObserve=typeof Object.observe=="function";function isIndex(s){return+s===s>>>0}function toNumber(s){return+s}function isObject(obj){return obj===Object(obj)}var numberIsNaN=global.Number.isNaN||function isNaN(value){return typeof value==="number"&&global.isNaN(value)};function areSameValue(left,right){if(left===right)return left!==0||1/left===1/right;if(numberIsNaN(left)&&numberIsNaN(right))return true;return left!==left&&right!==right}var createObject="__proto__"in{}?function(obj){return obj}:function(obj){var proto=obj.__proto__;if(!proto)return obj;var newObject=Object.create(proto);Object.getOwnPropertyNames(obj).forEach(function(name){Object.defineProperty(newObject,name,Object.getOwnPropertyDescriptor(obj,name))});return newObject};function ensureMapSetForEach(){if(Map.prototype.forEach&&Set.prototype.forEach)return;var keyMap=new WeakMap;function getKeyMap(obj){var map=keyMap.get(obj);if(!map){map=Object.create(null);keyMap.set(obj,map)}return map}var objectKeys=new WeakMap;var numberKeys=Object.create(null);var stringKeys=Object.create(null);var uidCounter=4;function getUid(key){if(key===null)return"$0";var keys,uid;switch(typeof key){case"undefined":return"$1";case"boolean":return"$"+(key+2);case"object":case"function":uid=objectKeys.get(key);if(!uid){uid="$"+uidCounter++;objectKeys.set(key,uid)}return uid;case"number":keys=numberKeys;break;case"string":keys=stringKeys;break}uid=keys[key];if(!uid){uid="$"+uidCounter++;keys[key]=uid}return uid}var MapSet=Map.prototype.set;var MapDelete=Map.prototype.delete;var SetAdd=Set.prototype.add;var SetDelete=Set.prototype.delete;Map.prototype.set=function(key,value){var uid=getUid(key);var keyMap=getKeyMap(this);keyMap[uid]=key;return MapSet.call(this,key,value)};Map.prototype.delete=function(key){var uid=getUid(key);var keyMap=getKeyMap(this);delete keyMap[uid];return MapDelete.call(this,key)};Map.prototype.forEach=function(f,opt_this){var keyMap=getKeyMap(this);for(var uid in keyMap){var key=keyMap[uid];var value=this.get(key);f.call(opt_this||this,value,key,this)}};Set.prototype.add=function(key){var uid=getUid(key);var keyMap=getKeyMap(this);keyMap[uid]=key;return SetAdd.call(this,key)};Set.prototype.delete=function(key){var uid=getUid(key);var keyMap=getKeyMap(this);delete keyMap[uid];return SetDelete.call(this,key)};Set.prototype.forEach=function(f,opt_this){var keyMap=getKeyMap(this);for(var uid in keyMap){var key=keyMap[uid];f.call(opt_this||this,key,key,this)}};Map.getValueSet=function(map){var set=new Set;map.forEach(function(value,key){set.add(value)});return set}}function polyfillMapSet(global){function Map(){this.values_=[];this.keys_=[]}Map.prototype={get:function(key){return this.values_[this.keys_.indexOf(key)]},set:function(key,value){var index=this.keys_.indexOf(key);if(index<0)index=this.keys_.length;this.keys_[index]=key;this.values_[index]=value},has:function(key){return this.keys_.indexOf(key)>=0},"delete":function(key){var index=this.keys_.indexOf(key);if(index<0)return false;this.keys_.splice(index,1);this.values_.splice(index,1);return true},forEach:function(f,opt_this){for(var i=0;i<this.keys_.length;i++)f.call(opt_this||this,this.values_[i],this.keys_[i],this)},get size(){return this.keys_.length}};function Set(){this.keys_=[]}Set.prototype={add:function(key){if(this.keys_.indexOf(key)<0)this.keys_.push(key)},has:function(key){return this.keys_.indexOf(key)>=0},"delete":function(key){var index=this.keys_.indexOf(key);if(index<0)return false;this.keys_.splice(index,1);return true},forEach:function(f,opt_this){for(var i=0;i<this.keys_.length;i++)f.call(opt_this||this,this.keys_[i],this.keys_[i],this)},get size(){return this.keys_.length}};Map.getValueSet=function(map){var set=new Set;set.keys_=map.values_.slice();return set};global.Map=Map;global.Set=Set}if(typeof Map==="function"&&typeof Set==="function"&&typeof WeakMap==="function")ensureMapSetForEach();
else polyfillMapSet(global);var pathIndentPart="[$a-z0-9_]+[$a-z0-9_\\d]*";var pathRegExp=new RegExp("^"+"(?:#?"+pathIndentPart+")?"+"(?:"+"(?:\\."+pathIndentPart+")"+")*"+"$","i");function isPathValid(s){if(typeof s!="string")return false;s=s.replace(/\s/g,"");if(s=="")return true;if(s[0]==".")return false;return pathRegExp.test(s)}function Path(s){if(s.trim()=="")return this;if(isIndex(s)){this.push(String(s));return this}s.split(/\./).filter(function(part){return part}).forEach(function(part){this.push(part)},this)}Path.prototype=createObject({__proto__:[],toString:function(){return this.join(".")},walkPropertiesFrom:function(val,f,that){var caughtException;var prop;for(var i=0;i<this.length+1;i++){prop=this[i];f.call(that,prop,val,i);if(i==this.length||val===null||val===undefined)val=undefined;else val=val[prop]}}});var MAX_DIRTY_CHECK_CYCLES=1e3;function ChangeSummary(externalCallback){var observing=true;var isDisconnecting=false;var isDelivering=false;var changesDelivered=false;var summaries;var internal={objectObservers:new Map,bindingPriorityCounter:1,getObjectObserver:function(obj){return this.objectObservers.get(obj)},getOrCreateObjectObserver:function(obj){var observer=this.objectObservers.get(obj);if(!observer){observer=new ObjectObserver(this,obj);this.objectObservers.set(obj,observer)}return observer},removeObjectObserver:function(obj){this.objectObservers.delete(obj)},nextBindingPriority:function(){return this.bindingPriorityCounter++},addPathTracker:function(obj,pathTracker){this.getOrCreateObjectObserver(obj).addPathTracker(pathTracker)},removePathTracker:function(obj,pathTracker){this.getObjectObserver(obj).removePathTracker(pathTracker)},connect:function(){this.objectObservers.forEach(function(observer){observer.connect()})},disconnect:function(){this.objectObservers.forEach(function(observer,object){observer.disconnect()})},internalCallback:function(records){if(!records||!records.length){console.error("Object.observe callback called with no records");return}try{if(!isDelivering)this.activeObservers=new Set;var changedObject;var observer;for(var i=0;i<records.length;i++){var record=records[i];if(changedObject!==record.object){changedObject=record.object;observer=this.getObjectObserver(changedObject);if(!observer){changedObject=undefined;continue}this.activeObservers.add(observer)}observer.addChangeRecord(record)}if(isDelivering)return;isDelivering=true;this.deliverSummaries();isDelivering=false}catch(ex){console.error(ex)}},dirtyCheck:function(){var cycles=0;do{try{cycles++;this.activeObservers=Map.getValueSet(this.objectObservers);this.deliverSummaries()}catch(ex){console.error(ex)}}while(changesDelivered&&cycles<MAX_DIRTY_CHECK_CYCLES)},resolveBindings:function(){var methods=this.planner.getPlan();if(!methods)console.error("Error: bindings are over-constrained");var changed=false;for(var i=0;i<methods.length;i++){var method=methods[i];var pathTracker=method.to;if(!pathTracker.setValue(method.from.value))break;changed=true;var observer=this.getOrCreateObjectObserver(pathTracker.object);observer.addDirtyPath(pathTracker);this.activeObservers.add(observer)}return changed},deliverSummaries:function(){summaries=[];var shouldResolveBindings=false;this.activeObservers.forEach(function(observer){shouldResolveBindings=observer.checkPathValues()||shouldResolveBindings});if(shouldResolveBindings){if(this.resolveBindings()&&hasObserve)Object.deliverChangeRecords(internal.callback)}this.activeObservers.forEach(function(observer){observer.checkObjectsAndArrays()});this.activeObservers.forEach(function(observer){var summary=observer.produceSummary();observer.reset();if(summary)summaries.push(summary)});this.activeObservers=undefined;if(!summaries.length)summaries=undefined;if(isDisconnecting||!summaries){changesDelivered=false;return}externalCallback(summaries);summaries=undefined;changesDelivered=true}};internal.callback=internal.internalCallback.bind(internal);if(hasObserve){var register={};Object.observe(register,internal.callback);Object.unobserve(register,internal.callback)}this.observeObject=function(obj){if(!isObject(obj))throw Error("Invalid attempt to observe non-object: "+obj);internal.getOrCreateObjectObserver(obj).observeObject()};this.unobserveObject=function(obj){if(!isObject(obj))throw Error("Invalid attempt to unobserve non-object: "+obj);var observer=internal.getObjectObserver(obj);if(!observer)return;observer.unobserveObject()};this.observeArray=function(arr){if(!Array.isArray(arr))throw Error("Invalid attempt to observe non-array: "+arr);internal.getOrCreateObjectObserver(arr).observeArray()};this.unobserveArray=function(arr){if(!Array.isArray(arr))return;var observer=internal.getObjectObserver(arr);if(!observer)return;observer.unobserveArray()};this.observePath=function(obj,pathString){if(!isPathValid(pathString))return undefined;var path=new Path(pathString);if(!path.length)return obj;if(!isObject(obj))return undefined;var pathTracker=internal.getOrCreateObjectObserver(obj).observePath(path);return pathTracker.value};this.unobservePath=function(obj,pathString){if(!isPathValid(pathString))return;var path=new Path(pathString);if(!path.length)return;if(!isObject(obj))return;var observer=internal.getObjectObserver(obj);if(!observer)return;observer.unobservePath(path)};this.bind=function(obj1,pathString1,obj2,pathString2){if(typeof global.Planner!=="function")throw Error("Binding requires Planner library");if(!isPathValid(pathString1)||!isPathValid(pathString2))throw Error("Not implemented");var path1=new Path(pathString1);var path2=new Path(pathString2);if(!path1.length||!path2.length||!isObject(obj1)||!isObject(obj2))throw Error("Not implemented");if(!internal.planner)internal.planner=new Planner;var pathTracker1=internal.getOrCreateObjectObserver(obj1).observePath(path1,true);var pathTracker2=internal.getOrCreateObjectObserver(obj2).observePath(path2,true);if(pathTracker2.bindings&&tracker2.bindings.has(pathTracker1))return;if(pathTracker1.bindings&&pathTracker1.bindings.has(pathTracker2))return;if(!pathTracker1.bindings)pathTracker1.bindings=new Map;if(!pathTracker1.variable){var priority1=internal.nextBindingPriority();pathTracker1.variable=internal.planner.addVariable(function(){return pathTracker1.changed?priority1:Infinity})}if(!pathTracker2.variable){var priority2=internal.nextBindingPriority();pathTracker2.variable=internal.planner.addVariable(function(){return pathTracker2.changed?priority2:Infinity})}var constraint=internal.planner.addConstraint();pathTracker1.bindings.set(pathTracker2,constraint);var toMethod=constraint.addMethod(pathTracker2.variable);var fromMethod=constraint.addMethod(pathTracker1.variable);toMethod.from=pathTracker1;toMethod.to=pathTracker2;toMethod.name=pathTracker2.path.toString()+"->"+pathTracker1.path.toString();fromMethod.from=pathTracker2;fromMethod.to=pathTracker1;toMethod.name=pathTracker1.path.toString()+"->"+pathTracker2.path.toString();if(pathTracker1.value===pathTracker2.value)return;if(pathTracker1.value===undefined)pathTracker1.setValue(pathTracker2.value);else pathTracker2.setValue(pathTracker1.value)};this.unbind=function(obj1,pathString1,obj2,pathString2){throw Error("Not implemented")};this.deliver=function(){if(!observing)throw Error("Disconnected");if(hasObserve)Object.deliverChangeRecords(internal.callback);else internal.dirtyCheck()};this.disconnect=function(){if(!observing)return;isDisconnecting=true;this.deliver();isDisconnecting=false;internal.disconnect();observing=false;if(!summaries)return;var retval=summaries;summaries=undefined;return retval};this.connect=function(){if(observing)return;internal.connect();observing=true}}ChangeSummary.getValueAtPath=function(obj,pathString){if(!isPathValid(pathString))return undefined;var path=new Path(pathString);if(!path.length)return obj;if(!isObject(obj))return;var retval;path.walkPropertiesFrom(obj,function(prop,value,i){if(i==this.length)retval=value},path);return retval};function internalSetValueAtPath(obj,path,value){var changed=false;path.walkPropertiesFrom(obj,function(prop,m,i){if(isObject(m)&&i==path.length-1){changed=true;m[prop]=value}});return changed}ChangeSummary.setValueAtPath=function(obj,pathString,value){if(!isPathValid(pathString))return;var path=new Path(pathString);if(!path.length)return;if(!isObject(obj))return;internalSetValueAtPath(obj,path,value)};ChangeSummary.applySplices=function(previous,current,splices){splices.forEach(function(splice){var spliceArgs=[splice.index,splice.removed.length];var addIndex=splice.index;while(addIndex<splice.index+splice.addedCount){spliceArgs.push(current[addIndex]);addIndex++}Array.prototype.splice.apply(previous,spliceArgs)})};function objectIsEmpty(object){for(var prop in object)return false;return true}function diffIsEmpty(diff){return objectIsEmpty(diff.added)&&objectIsEmpty(diff.removed)&&objectIsEmpty(diff.changed)}function diffObjectFromOldObject(object,oldObject){var added={};var removed={};var changed={};var oldObjectHas={};for(var prop in oldObject){var newValue=object[prop];if(newValue!==undefined&&newValue===oldObject[prop])continue;if(!(prop in object)){removed[prop]=undefined;continue}if(newValue!==oldObject[prop])changed[prop]=newValue}for(var prop in object){if(prop in oldObject)continue;added[prop]=object[prop]}if(Array.isArray(object)&&object.length!==oldObject.length)changed.length=object.length;return{added:added,removed:removed,changed:changed}}function copyObject(object,opt_copy){var copy=opt_copy||(Array.isArray(object)?[]:{});for(var prop in object){copy[prop]=object[prop]}if(Array.isArray(object))copy.length=object.length;return copy}function ObjectTracker(object){this.object=object;this.changed=false;this.diff=undefined;this.oldValues=undefined;this.reset(true)}ObjectTracker.prototype={check:function(changeRecords){var diff;var oldValues;if(hasObserve){if(!changeRecords)return false;oldValues={};diff=diffObjectFromChangeRecords(this.object,changeRecords,oldValues)}else{oldValues=this.oldObject;diff=diffObjectFromOldObject(this.object,this.oldObject)}if(diffIsEmpty(diff))return false;this.diff=diff;this.oldValues=oldValues;this.changed=true;return true},summarize:function(summary,oldValues){summary.added=this.changed?this.diff.added:{};summary.removed=this.changed?this.diff.removed:{};summary.changed=this.changed?this.diff.changed:{};copyObject(this.oldValues,oldValues)},reset:function(force){if(!hasObserve&&(force||this.diff))this.oldObject=copyObject(this.object);this.changed=false;this.diff=undefined;this.oldValues=undefined}};function ArrayTracker(array){this.array=array;this.changed=false;this.splices=undefined;this.reset(true)}ArrayTracker.prototype={check:function(changeRecords){var splices;if(hasObserve){if(!changeRecords)return false;var oldValues={};var diff=diffObjectFromChangeRecords(this.array,changeRecords,oldValues);splices=projectArraySplices(this.array,diff,oldValues)}else{splices=calcSplices(this.array,0,this.array.length,this.oldArray,0,this.oldArray.length)}if(!splices.length)return false;this.splices=splices;this.changed=true;return true},summarize:function(summary){summary.splices=this.splices?this.splices:[]},reset:function(force){if(!hasObserve&&(force||this.splices))this.oldArray=this.array.slice();this.changed=false;this.splices=undefined}};function PathTracker(object,path,pathString,internal){this.object=object;this.path=path;this.pathString=pathString;this.observed=path.length>1?new Array(path.length-2):undefined;this.changed=false;this.oldValue=undefined;this.bound=false;this.reporting=false;this.bindings=undefined;this.variable=undefined;this.internal=internal;this.reset(true)}var hasEval=false;try{var f=new Function("","return true;");hasEval=f()}catch(ex){}var pathTrackerCheck;if(hasObserve){pathTrackerCheck=function(){var newValue;this.path.walkPropertiesFrom(this.object,function(prop,value,i){if(i===this.path.length){newValue=value;return}if(i===0)return;var observed=this.observed[i-1];if(value===observed)return;if(observed!==undefined){this.observed[i-1]=observed=undefined;var stillObserving=false;for(var j=0;j<this.observed.length;j++){if(this.observed[j]===observed){stillObserving=true;break}}if(!stillObserving)this.internal.removePathTracker(observed,this)}if(!isObject(value))return;this.observed[i-1]=observed=value;this.internal.addPathTracker(observed,this)},this);return this.isChanged(newValue)}}else if(hasEval){pathTrackerCheck=function(){if(!this.checkFunc){var str="";var partStr="obj";var length=this.path.length;str+="if (obj";for(var i=0;i<length-1;i++){var part='["'+this.path[i]+'"]';partStr+=part;str+=" && "+partStr}str+=") ";partStr+='["'+this.path[length-1]+'"]';str+="return "+partStr+"; else return undefined;";this.checkFunc=new Function("obj",str)}return this.isChanged(this.checkFunc(this.object))}}else{pathTrackerCheck=function(){var newValue;this.path.walkPropertiesFrom(this.object,function(prop,value,i){if(i===this.path.length)newValue=value},this);return this.isChanged(newValue)}}PathTracker.prototype={check:pathTrackerCheck,isChanged:function(newValue){if(!this.changed)this.oldValue=this.value;this.value=newValue;this.changed=!areSameValue(this.oldValue,this.value);return this.changed},setValue:function(newValue){var changed=internalSetValueAtPath(this.object,this.path,newValue);if(!changed)return false;this.isChanged(newValue);return changed},summarize:function(summary,oldValues){summary.pathChanged[this.pathString]=this.value;oldValues[this.pathString]=this.oldValue},reset:function(force){if(force)this.check();this.oldValue=undefined;this.changed=false},destroy:function(){this.object=undefined;this.reset(true)}};function ObjectObserver(internal,object){this.internal=internal;this.object=object;this.objectTracker=undefined;this.arrayTracker=undefined;this.pathTrackers=undefined;this.pathTrackerMap=undefined;this.changeRecords=undefined;this.dirtyPathTrackers=undefined;this.connect()}ObjectObserver.prototype={observeObject:function(){this.objectTracker=this.objectTracker||new ObjectTracker(this.object)},unobserveObject:function(){this.objectTracker=undefined;this.destroyIfEmpty()},observeArray:function(){this.arrayTracker=this.arrayTracker||new ArrayTracker(this.object)},unobserveArray:function(){this.arrayTracker=undefined;this.destroyIfEmpty()},addPathTracker:function(pathTracker,opt_pathString){if(!this.pathTrackers){this.pathTrackers=[];this.pathTrackerMap={}}if(opt_pathString)this.pathTrackerMap[opt_pathString]=pathTracker;this.pathTrackers.push(pathTracker)},removePathTracker:function(pathTracker){if(!this.pathTrackers)return;this.pathTrackers.splice(this.pathTrackers.indexOf(pathTracker),1);if(!this.pathTrackers.length)this.pathTrackers=undefined;this.destroyIfEmpty()},observePath:function(path,forBinding){var pathTracker;var pathString=path.toString();if(this.pathTrackers&&this.pathTrackerMap)pathTracker=this.pathTrackerMap[pathString];if(pathTracker){pathTracker.check()}else{pathTracker=new PathTracker(this.object,path,pathString,this.internal);this.addPathTracker(pathTracker,pathString)}if(forBinding)pathTracker.bound=true;else pathTracker.reporting=true;return pathTracker},unobservePath:function(path,forBinding){if(!this.pathTrackerMap)return;var pathString=path.toString();var pathTracker=this.pathTrackerMap[pathString];if(!pathTracker)return;if(forBinding)pathTracker.bound=forBinding;else pathTracker.reporting=false;if(pathTracker.bound||pathTracker.reporting)return;pathTracker.destroy();delete this.pathTrackerMap[pathString];if(!Object.keys(this.pathTrackerMap).length)this.pathTrackerMap=undefined;this.pathTrackers.splice(this.pathTrackers.indexOf(pathTracker),1);if(!this.pathTrackers.length)this.pathTrackers=undefined;this.destroyIfEmpty()},connect:function(){if(hasObserve)Object.observe(this.object,this.internal.callback);this.reset(true)},disconnect:function(){if(hasObserve)Object.unobserve(this.object,this.internal.callback)},destroyIfEmpty:function(){if(this.objectTracker||this.arrayTracker||this.pathTrackers)return;this.internal.removeObjectObserver(this.object);this.destroy()},destroy:function(){this.disconnect();this.internal=undefined},addChangeRecord:function(changeRecord){if(!this.changeRecords)this.changeRecords=[];this.changeRecords.push(changeRecord)},checkPathValues:function(changeRecords){if(!this.internal)return;if(!this.pathTrackers)return;var bindingsAreDirty=false;for(var i=0;i<this.pathTrackers.length;i++){var pathTracker=this.pathTrackers[i];if(pathTracker.check()){var isThis=this.object===pathTracker.object;var observer=isThis?this:this.internal.getOrCreateObjectObserver(pathTracker.object);observer.addDirtyPath(pathTracker);if(!isThis)this.internal.activeObservers.add(observer);if(pathTracker.variable)bindingsAreDirty=true}}return bindingsAreDirty},checkObjectsAndArrays:function(){if(!this.internal)return;if(this.objectTracker)this.objectTracker.check(this.changeRecords);if(this.arrayTracker)this.arrayTracker.check(this.changeRecords)},addDirtyPath:function(pathTracker){if(!this.dirtyPathTrackers)this.dirtyPathTrackers=new Set;this.dirtyPathTrackers.add(pathTracker)},produceSummary:function(){if((!this.objectTracker||!this.objectTracker.changed)&&(!this.arrayTracker||!this.arrayTracker.changed)&&!this.dirtyPathTrackers)return;var oldValues;var summary={object:this.object};if(this.objectTracker||this.pathTrackerMap){oldValues={};summary.getOldValue=function(propOrPath){return oldValues[propOrPath]}}if(this.pathTrackerMap)summary.pathChanged={};var changed=false;if(this.objectTracker){this.objectTracker.summarize(summary,oldValues);changed=changed||this.objectTracker.changed}if(this.arrayTracker){this.arrayTracker.summarize(summary);changed=changed||this.arrayTracker.changed}if(this.dirtyPathTrackers){this.dirtyPathTrackers.forEach(function(pathTracker){if(!pathTracker.changed||!pathTracker.reporting)return;pathTracker.summarize(summary,oldValues);changed=true})}if(changed)return summary},reset:function(force){if(this.objectTracker)this.objectTracker.reset(force);if(this.arrayTracker)this.arrayTracker.reset(force);var pathTrackersToReset=force?this.pathTrackers:this.dirtyPathTrackers;if(pathTrackersToReset)pathTrackersToReset.forEach(function(pathTracker){pathTracker.reset(force)});this.changeRecords=undefined;this.dirtyPathTrackers=undefined}};var knownRecordTypes={"new":true,updated:true,deleted:true};function diffObjectFromChangeRecords(object,changeRecords,oldValues){var added={};var removed={};for(var i=0;i<changeRecords.length;i++){var record=changeRecords[i];if(!knownRecordTypes[record.type]){console.error("Unknown changeRecord type: "+record.type);console.error(record);continue}if(!(record.name in oldValues))oldValues[record.name]=record.oldValue;if(record.type=="updated")continue;if(record.type=="new"){if(record.name in removed)delete removed[record.name];else added[record.name]=true;continue}if(record.name in added){delete added[record.name];delete oldValues[record.name]}else{removed[record.name]=true}}for(var prop in added)added[prop]=object[prop];for(var prop in removed)removed[prop]=undefined;var changed={};for(var prop in oldValues){if(prop in added||prop in removed)continue;var newValue=object[prop];if(oldValues[prop]!==newValue)changed[prop]=newValue}return{added:added,removed:removed,changed:changed}}function calcEditDistances(current,currentStart,currentEnd,old,oldStart,oldEnd){var rowCount=oldEnd-oldStart+1;var columnCount=currentEnd-currentStart+1;var distances=new Array(rowCount);for(var i=0;i<rowCount;i++){distances[i]=new Array(columnCount);distances[i][0]=i}for(var j=0;j<columnCount;j++)distances[0][j]=j;for(var i=1;i<rowCount;i++){for(var j=1;j<columnCount;j++){if(old[oldStart+i-1]===current[currentStart+j-1])distances[i][j]=distances[i-1][j-1];else{var north=distances[i-1][j]+1;var west=distances[i][j-1]+1;distances[i][j]=north<west?north:west}}}return distances}var EDIT_LEAVE=0;var EDIT_UPDATE=1;var EDIT_ADD=2;var EDIT_DELETE=3;function spliceOperationsFromEditDistances(distances){var i=distances.length-1;var j=distances[0].length-1;var current=distances[i][j];var edits=[];while(i>0||j>0){if(i==0){edits.push(EDIT_ADD);j--;continue}if(j==0){edits.push(EDIT_DELETE);i--;continue}var northWest=distances[i-1][j-1];var west=distances[i-1][j];var north=distances[i][j-1];var min;if(west<north)min=west<northWest?west:northWest;else min=north<northWest?north:northWest;if(min==northWest){if(northWest==current){edits.push(EDIT_LEAVE)}else{edits.push(EDIT_UPDATE);current=northWest}i--;j--}else if(min==west){edits.push(EDIT_DELETE);i--;current=west}else{edits.push(EDIT_ADD);j--;current=north}}edits.reverse();return edits}function sharedPrefix(arr1,arr2,searchLength){for(var i=0;i<searchLength;i++)if(arr1[i]!==arr2[i])return i;return searchLength}function sharedSuffix(arr1,arr2,searchLength){var index1=arr1.length;var index2=arr2.length;var count=0;while(count<searchLength&&arr1[--index1]===arr2[--index2])count++;return count}function calcSplices(current,currentStart,currentEnd,old,oldStart,oldEnd){var prefixCount=0;var suffixCount=0;var minLength=Math.min(currentEnd-currentStart,oldEnd-oldStart);if(currentStart==0&&oldStart==0)prefixCount=sharedPrefix(current,old,minLength);if(currentEnd==current.length&&oldEnd==old.length)suffixCount=sharedSuffix(current,old,minLength-prefixCount);currentStart+=prefixCount;oldStart+=prefixCount;currentEnd-=suffixCount;oldEnd-=suffixCount;if(currentEnd-currentStart==0&&oldEnd-oldStart==0)return[];function newSplice(index,removed,addedCount){return{index:index,removed:removed,addedCount:addedCount}}if(currentStart==currentEnd){var splice=newSplice(currentStart,[],0);while(oldStart<oldEnd)splice.removed.push(old[oldStart++]);return[splice]}else if(oldStart==oldEnd)return[newSplice(currentStart,[],currentEnd-currentStart)];var ops=spliceOperationsFromEditDistances(calcEditDistances(current,currentStart,currentEnd,old,oldStart,oldEnd));var splice=undefined;var splices=[];var index=currentStart;var oldIndex=oldStart;for(var i=0;i<ops.length;i++){switch(ops[i]){case EDIT_LEAVE:if(splice){splices.push(splice);splice=undefined}index++;oldIndex++;break;case EDIT_UPDATE:if(!splice)splice=newSplice(index,[],0);splice.addedCount++;index++;splice.removed.push(old[oldIndex]);oldIndex++;break;case EDIT_ADD:if(!splice)splice=newSplice(index,[],0);splice.addedCount++;index++;break;case EDIT_DELETE:if(!splice)splice=newSplice(index,[],0);splice.removed.push(old[oldIndex]);oldIndex++;break}}if(splice){splices.push(splice)}return splices}function createInitialSplicesFromDiff(array,diff,oldValues){var oldLength="length"in oldValues?toNumber(oldValues.length):array.length;var lengthChangeSplice;if(array.length>oldLength){lengthChangeSplice={index:oldLength,removed:[],addedCount:array.length-oldLength}}else if(array.length<oldLength){lengthChangeSplice={index:array.length,removed:new Array(oldLength-array.length),addedCount:0}}var indicesChanged=[];function addProperties(properties,oldValues){Object.keys(properties).forEach(function(prop){var index=toNumber(prop);if(isNaN(index)||index<0||index>=oldLength)return;var oldValue=oldValues[index];if(index<array.length)indicesChanged[index]=oldValue;else lengthChangeSplice.removed[index-array.length]=oldValues[index]})}addProperties(diff.added,oldValues);addProperties(diff.removed,oldValues);addProperties(diff.changed,oldValues);var splices=[];var current;for(var index in indicesChanged){index=toNumber(index);if(current){if(current.index+current.removed.length==index){current.removed.push(indicesChanged[index]);continue}current.addedCount=Math.min(array.length,current.index+current.removed.length)-current.index;splices.push(current);current=undefined}current={index:index,removed:[indicesChanged[index]]}}if(current){current.addedCount=Math.min(array.length,current.index+current.removed.length)-current.index;if(lengthChangeSplice){if(current.index+current.removed.length==lengthChangeSplice.index){current.addedCount=current.addedCount+lengthChangeSplice.addedCount;current.removed=current.removed.concat(lengthChangeSplice.removed);splices.push(current)}else{splices.push(current);splices.push(lengthChangeSplice)}}else{splices.push(current)}}else if(lengthChangeSplice){splices.push(lengthChangeSplice)}return splices}function projectArraySplices(array,diff,oldValues){var splices=[];createInitialSplicesFromDiff(array,diff,oldValues).forEach(function(splice){splices=splices.concat(calcSplices(array,splice.index,splice.index+splice.addedCount,splice.removed,0,splice.removed.length))});return splices}global.ChangeSummary=ChangeSummary;function CallbackRouter(){var callbacksMap=typeof WeakMap=="function"?new WeakMap:new Map;function invokeCallbacks(summary){var callbacks=callbacksMap.get(summary.object);if(!callbacks)return;if(callbacks.object&&(summary.added||summary.removed||summary.changed)){callbacks.object.forEach(function(callback){try{callback(summary.added,summary.removed,summary.changed,summary.getOldValue,summary.object)}catch(ex){console.log("Exception thrown during callback: "+ex);ChangeSummary._errorThrownDuringCallback=true}})}if(callbacks.array&&summary.splices){callbacks.array.forEach(function(callback){try{callback(summary.splices,summary.object)}catch(ex){console.log("Exception thrown during callback: "+ex);ChangeSummary._errorThrownDuringCallback=true}})}if(callbacks.path&&summary.pathChanged){Object.keys(callbacks.path).forEach(function(path){if(!summary.pathChanged.hasOwnProperty(path))return;callbacks.path[path].forEach(function(callback){try{callback(summary.pathChanged[path],summary.getOldValue(path),summary.object,path)}catch(ex){console.log("Exception thrown during callback: "+ex);ChangeSummary._errorThrownDuringCallback=true}})})}}var observer=new ChangeSummary(function(summaries){summaries.forEach(invokeCallbacks)});this.observeObject=function(object,callback){var callbacks=callbacksMap.get(object);if(!callbacks){callbacks={};callbacksMap.set(object,callbacks)}if(!callbacks.object){callbacks.object=new Set;observer.observeObject(object)}callbacks.object.add(callback)};this.unobserveObject=function(object,callback){var callbacks=callbacksMap.get(object);if(!callbacks||!callbacks.object)return;callbacks.object.delete(callback);if(!callbacks.object.size){observer.unobserveObject(object);callbacks.object=undefined}if(!callbacks.object&&!callbacks.array&&!callbacks.path)callbacksMap.delete(object)};this.observeArray=function(array,callback){if(!Array.isArray(array))throw Error("Invalid attempt to observe non-array: "+arr);var callbacks=callbacksMap.get(array);if(!callbacks){callbacks={};callbacksMap.set(array,callbacks)}if(!callbacks.array){callbacks.array=new Set;observer.observeArray(array)}callbacks.array.add(callback)};this.unobserveArray=function(array,callback){if(!Array.isArray(array))return;var callbacks=callbacksMap.get(array);if(!callbacks||!callbacks.array)return;callbacks.array.delete(callback);if(!callbacks.array.size){observer.unobserveArray(array);callbacks.array=undefined}if(!callbacks.object&&!callbacks.array&&!callbacks.path)callbacksMap.delete(array)};this.observePath=function(object,path,callback){if(!isPathValid(path))return undefined;if(path.trim()=="")return object;if(!isObject(object))return undefined;var callbacks=callbacksMap.get(object);if(!callbacks){callbacks={};callbacksMap.set(object,callbacks)}if(!callbacks.path)callbacks.path={};var pathCallbacks=callbacks.path[path];var retval;if(!pathCallbacks){pathCallbacks=new Set;callbacks.path[path]=pathCallbacks;retval=observer.observePath(object,path)}else{retval=ChangeSummary.getValueAtPath(object,path)}pathCallbacks.add(callback);return retval};this.unobservePath=function(object,path,callback){if(!isPathValid(path)||!isObject(object))return;var callbacks=callbacksMap.get(object);if(!callbacks||!callbacks.path)return;var pathCallbacks=callbacks.path[path];if(!pathCallbacks)return;pathCallbacks.delete(callback);if(!pathCallbacks.size){observer.unobservePath(object,path);delete callbacks.path[path]}if(!Object.keys(callbacks.path).length)callbacks.path=undefined;if(!callbacks.object&&!callbacks.array&&!callbacks.path)callbacksMap.delete(object)};this.bind=function(obj1,path1,obj2,path2){observer.bind(obj1,path1,obj2,path2)};this.unbind=function(obj1,path1,obj2,path2){observer.unbind(obj1,path1,obj2,path2)};this.deliver=observer.deliver.bind(observer)}global.ChangeSummary.CallbackRouter=CallbackRouter})(this);var createObject="__proto__"in{}?function(obj){return obj}:function(obj){var proto=obj.__proto__;if(!proto)return obj;var newObject=Object.create(proto);Object.getOwnPropertyNames(obj).forEach(function(name){Object.defineProperty(newObject,name,Object.getOwnPropertyDescriptor(obj,name))});return newObject};if(typeof document.createElement("div").hidden!="boolean"){Object.defineProperty(HTMLElement.prototype,"hidden",{get:function(){return this.hasAttribute("hidden")},set:function(b){if(b)this.setAttribute("hidden","");else this.removeAttribute("hidden")},enumerable:true,configurable:true});var styleElement=document.createElement("style");styleElement.textContent="[hidden] { display: none }";document.head.appendChild(styleElement)}var SideTable;if(typeof WeakMap!=="undefined"){SideTable=WeakMap}else{SideTable=function(name){this.name="__$"+name+"$__"};SideTable.prototype={set:function(key,value){Object.defineProperty(key,this.name,{value:value,writable:true})},get:function(key){return key[this.name]},"delete":function(key){this.set(key,undefined)}}}function SideTableInherit(name){this.map=new SideTable(name)}SideTableInherit.prototype={set:function(key,value){this.map.set(key,value)},get:function(key){if(key===null)return undefined;var value=this.map.get(key);if(value!==undefined)return value;return this.get(Object.getPrototypeOf(key))},"delete":function(key){this.map.delete(key)}};this.Model=function(){var router=new ChangeSummary.CallbackRouter;return{notifyChanges:function(){router.deliver()},getValueAtPath:ChangeSummary.getValueAtPath,setValueAtPath:ChangeSummary.setValueAtPath,observeObject:router.observeObject.bind(router),unobserveObject:router.unobserveObject.bind(router),observeArray:router.observeArray.bind(router),unobserveArray:router.unobserveArray.bind(router),observePath:router.observePath.bind(router),unobservePath:router.unobservePath.bind(router),bind:router.bind.bind(router),unbind:router.unbind.bind(router)}}();(function(){"use strict";function bindNode(name,model,path){console.error("Unhandled binding to Node: ",this,name,model,path)}function unbindNode(name){}function unbindAllNode(){}Node.prototype.bind=bindNode;Node.prototype.unbind=unbindNode;Node.prototype.unbindAll=unbindAllNode;var textContentBindingTable=new SideTable("textContentBinding");function Binding(model,path,changed){this.model=model;this.path=path;this.changed=changed;var value=Model.observePath(this.model,this.path,this.changed);this.changed(value)}Binding.prototype={unbind:function(){Model.unobservePath(this.model,this.path,this.changed)},set value(newValue){Model.setValueAtPath(this.model,this.path,newValue)}};function boundSetTextContent(textNode){return function(value){textNode.data=value}}function bindText(name,model,path){if(name!=="textContent")return Node.prototype.bind.call(this,name,model,path);this.unbind("textContent");var binding=new Binding(model,path,boundSetTextContent(this));textContentBindingTable.set(this,binding)}function unbindText(name){if(name!="textContent")return Node.prototype.unbind.call(this,name);var binding=textContentBindingTable.get(this);if(!binding)return;binding.unbind();textContentBindingTable.delete(this)}function unbindAllText(){this.unbind("textContent");Node.prototype.unbindAll.call(this)}Text.prototype.bind=bindText;Text.prototype.unbind=unbindText;Text.prototype.unbindAll=unbindAllText;var attributeBindingsTable=new SideTable("attributeBindings");function boundSetAttribute(element,attributeName,conditional){if(conditional){return function(value){if(!value)element.removeAttribute(attributeName);else element.setAttribute(attributeName,"")
}}return function(value){element.setAttribute(attributeName,String(value===undefined?"":value))}}function ElementAttributeBindings(){this.bindingMap=Object.create(null)}ElementAttributeBindings.prototype={add:function(element,attributeName,model,path){element.removeAttribute(attributeName);var conditional=attributeName[attributeName.length-1]=="?";if(conditional)attributeName=attributeName.slice(0,-1);this.remove(attributeName);var binding=new Binding(model,path,boundSetAttribute(element,attributeName,conditional));this.bindingMap[attributeName]=binding},remove:function(attributeName){var binding=this.bindingMap[attributeName];if(!binding)return;binding.unbind();delete this.bindingMap[attributeName]},removeAll:function(){Object.keys(this.bindingMap).forEach(function(attributeName){this.remove(attributeName)},this)}};function bindElement(name,model,path){var bindings=attributeBindingsTable.get(this);if(!bindings){bindings=new ElementAttributeBindings;attributeBindingsTable.set(this,bindings)}bindings.add(this,name,model,path)}function unbindElement(name){var bindings=attributeBindingsTable.get(this);if(bindings)bindings.remove(name)}function unbindAllElement(name){var bindings=attributeBindingsTable.get(this);if(!bindings)return;attributeBindingsTable.delete(this);bindings.removeAll();Node.prototype.unbindAll.call(this)}Element.prototype.bind=bindElement;Element.prototype.unbind=unbindElement;Element.prototype.unbindAll=unbindAllElement;var valueBindingTable=new SideTable("valueBinding");var checkedBindingTable=new SideTable("checkedBinding");function getEventForInputType(element){switch(element.type){case"checkbox":return"click";case"radio":case"select-multiple":case"select-one":return"change";default:return"input"}}function InputBinding(element,model,path){this.element=element;this.boundValueChanged=this.valueChanged.bind(this);this.boundUpdateBinding=this.updateBinding.bind(this);this.binding=new Binding(model,path,this.boundValueChanged);this.element.addEventListener(getEventForInputType(this.element),this.boundUpdateBinding,true)}InputBinding.prototype={unbind:function(){this.binding.unbind();this.element.removeEventListener(getEventForInputType(this.element),this.boundUpdateBinding,true)}};function ValueBinding(element,model,path){InputBinding.call(this,element,model,path)}ValueBinding.prototype=createObject({__proto__:InputBinding.prototype,valueChanged:function(value){this.element.value=String(value==null?"":value)},updateBinding:function(){this.binding.value=this.element.value;Model.notifyChanges()}});function isNodeInDocument(node){return node.ownerDocument.contains(node)}var filter=Array.prototype.filter.call.bind(Array.prototype.filter);function getAssociatedRadioButtons(element){if(!isNodeInDocument(element))return[];if(element.form){return filter(element.form.elements,function(el){return el!=element&&el.tagName=="INPUT"&&el.type=="radio"&&el.name==element.name})}else{var radios=element.ownerDocument.querySelectorAll('input[type="radio"][name="'+element.name+'"]');return filter(radios,function(el){return el!=element&&!el.form})}}function CheckedBinding(element,model,path){InputBinding.call(this,element,model,path)}CheckedBinding.prototype=createObject({__proto__:InputBinding.prototype,valueChanged:function(newValue){this.element.checked=Boolean(newValue)},updateBinding:function(){var value=this.element.checked;this.binding.value=value;if(this.element.tagName==="INPUT"&&this.element.type==="radio"){getAssociatedRadioButtons(this.element).forEach(function(r){var checkedBinding=checkedBindingTable.get(r);if(checkedBinding){checkedBinding.binding.value=false}})}Model.notifyChanges()}});function bindInput(name,model,path){switch(name){case"value":this.unbind("value");this.removeAttribute("value");valueBindingTable.set(this,new ValueBinding(this,model,path));break;case"checked":this.unbind("checked");this.removeAttribute("checked");checkedBindingTable.set(this,new CheckedBinding(this,model,path));break;default:return Element.prototype.bind.call(this,name,model,path);break}}function unbindInput(name){switch(name){case"value":var valueBinding=valueBindingTable.get(this);if(valueBinding){valueBinding.unbind();valueBindingTable.delete(this)}break;case"checked":var checkedBinding=checkedBindingTable.get(this);if(checkedBinding){checkedBinding.unbind();checkedBindingTable.delete(this)}break;default:return Element.prototype.unbind.call(this,name);break}}function unbindAllInput(name){this.unbind("value");this.unbind("checked");Element.prototype.unbindAll.call(this)}HTMLInputElement.prototype.bind=bindInput;HTMLInputElement.prototype.unbind=unbindInput;HTMLInputElement.prototype.unbindAll=unbindAllInput})();(function(global){"use strict";function assert(v){if(!v)throw new Error("Assertion failed")}var forEach=Array.prototype.forEach.call.bind(Array.prototype.forEach);var BIND="bind";var REPEAT="repeat";var DELEGATE="delegate";var IF="if";var templateAttributeDirectives={template:true,repeat:true,bind:true,ref:true};var semanticTemplateElements={THEAD:true,TBODY:true,TFOOT:true,TH:true,TR:true,TD:true,COLGROUP:true,COL:true,OPTION:true};var hasTemplateElement=typeof HTMLTemplateElement!=="undefined";var allTemplatesSelectors="template, "+Object.keys(semanticTemplateElements).map(function(tagName){return tagName.toLowerCase()+"[template]"}).join(", ");function getTemplateDescendentsOf(node){return node.querySelectorAll(allTemplatesSelectors)}function isAttributeTemplate(el){return semanticTemplateElements[el.tagName]&&el.hasAttribute("template")}function isTemplate(el){return el.tagName=="TEMPLATE"||isAttributeTemplate(el)}function isNativeTemplate(el){return hasTemplateElement&&el.tagName=="TEMPLATE"}var ensureScheduled=function(){var scheduled=[];var delivering=[];var obj={value:0};var lastScheduled=obj.value;function ensureScheduled(fn){if(delivering.indexOf(fn)>=0||scheduled.indexOf(fn)>=0)return;scheduled.push(fn);if(lastScheduled==obj.value)obj.value=!obj.value}function runScheduled(){lastScheduled=obj.value;delivering=scheduled;scheduled=[];while(delivering.length){var nextFn=delivering.shift();nextFn()}}Model.observePath(obj,"value",runScheduled);return ensureScheduled}();document.addEventListener("DOMContentLoaded",function(e){bootstrapTemplatesRecursivelyFrom(document);Model.notifyChanges()},false);function bootstrapTemplatesRecursivelyFrom(node){function bootstrap(template){if(!HTMLTemplateElement.decorate(template))bootstrapTemplatesRecursivelyFrom(template.content)}var templateDescendents=getTemplateDescendentsOf(node);if(isTemplate(node))bootstrap(node);forEach(templateDescendents,bootstrap)}if(!hasTemplateElement){global.HTMLTemplateElement=function(){throw TypeError("Illegal constructor")}}var hasProto="__proto__"in{};function mixin(to,from){Object.getOwnPropertyNames(from).forEach(function(name){Object.defineProperty(to,name,Object.getOwnPropertyDescriptor(from,name))})}var templateContentsTable=new SideTable("templateContents");var templateContentsOwnerTable=new SideTable("templateContentsOwner");var templateInstanceRefTable=new SideTable("templateInstanceRef");function getTemplateContentsOwner(doc){if(!doc.defaultView)return doc;var d=templateContentsOwnerTable.get(doc);if(!d){d=doc.implementation.createHTMLDocument("");while(d.lastChild){d.removeChild(d.lastChild)}templateContentsOwnerTable.set(doc,d)}return d}function cloneAndSeperateAttributeTemplate(templateElement){var clone=templateElement.cloneNode(false);var attribs=templateElement.attributes;var count=attribs.length;while(count-->0){var attrib=attribs[count];if(templateAttributeDirectives[attrib.name])clone.removeAttribute(attrib.name);else templateElement.removeAttribute(attrib.name)}return clone}function liftNonNativeTemplateChildrenIntoContent(templateElement){var content=templateElement.content;if(!isAttributeTemplate(templateElement)){var child;while(child=templateElement.firstChild){content.appendChild(child)}return}var newRoot=cloneAndSeperateAttributeTemplate(templateElement);var child;while(child=templateElement.firstChild){newRoot.appendChild(child)}content.appendChild(newRoot)}HTMLTemplateElement.decorate=function(el,opt_instanceRef){if(el.templateIsDecorated_)return false;el.templateIsDecorated_=true;fixTemplateElementPrototype(el);if(!isNativeTemplate(el)){var doc=getTemplateContentsOwner(el.ownerDocument);templateContentsTable.set(el,doc.createDocumentFragment())}if(opt_instanceRef){templateInstanceRefTable.set(el,opt_instanceRef);return true}if(isNativeTemplate(el)){bootstrapTemplatesRecursivelyFrom(el.content)}else{liftNonNativeTemplateChildrenIntoContent(el)}return true};HTMLTemplateElement.bootstrap=bootstrapTemplatesRecursivelyFrom;HTMLTemplateElement.bindTree=addBindings;var htmlElement=global.HTMLUnknownElement||HTMLElement;var contentDescriptor={get:function(){return templateContentsTable.get(this)},enumerable:true,configurable:true};if(!hasTemplateElement){HTMLTemplateElement.prototype=Object.create(htmlElement.prototype);Object.defineProperty(HTMLTemplateElement.prototype,"content",contentDescriptor)}function fixTemplateElementPrototype(el){if(el.tagName==="TEMPLATE"){if(!hasTemplateElement){if(hasProto)el.__proto__=HTMLTemplateElement.prototype;else mixin(el,HTMLTemplateElement.prototype)}}else{mixin(el,HTMLTemplateElement.prototype);Object.defineProperty(el,"content",contentDescriptor)}}function createInstance(element,model,delegate){var content=element.ref?element.ref.content:element.content;return createDeepCloneAndDecorateTemplates(content)}mixin(HTMLTemplateElement.prototype,{bind:function(name,model,path){switch(name){case DELEGATE:case BIND:case REPEAT:case IF:var templateIterator=templateIteratorTable.get(this);if(!templateIterator){templateIterator=new TemplateIterator(this);templateIteratorTable.set(this,templateIterator)}if(name===DELEGATE){templateIterator.delegate=model}else{templateIterator.inputs.bind(name,model,path||"")}break;default:return Element.prototype.bind.call(this,name,model,path);break}},unbind:function(name,model,path){switch(name){case DELEGATE:break;case BIND:case REPEAT:case IF:var templateIterator=templateIteratorTable.get(this);if(!templateIterator)break;templateIterator.inputs.unbind(name);break;default:return Element.prototype.unbind.call(this,name,model,path);break}},unbindAll:function(){this.unbind(BIND);this.unbind(REPEAT);this.unbind(IF);Element.prototype.unbindAll.call(this)},createInstance:function(model,delegate){return createInstance(this,model,delegate)},get ref(){var ref;var refId=this.getAttribute("ref");if(refId)ref=this.ownerDocument.getElementById(refId);if(!ref)ref=templateInstanceRefTable.get(this);return ref||null}});var TEXT=0;var BINDING=1;function Token(type,value){this.type=type;this.value=value}function parseMustacheTokens(s){var result=[];var length=s.length;var index=0,lastIndex=0;while(lastIndex<length){index=s.indexOf("{{",lastIndex);if(index<0){result.push(new Token(TEXT,s.slice(lastIndex)));break}else{if(index>0&&lastIndex<index){result.push(new Token(TEXT,s.slice(lastIndex,index)))}lastIndex=index+2;index=s.indexOf("}}",lastIndex);if(index<0){var text=s.slice(lastIndex-2);var lastToken=result[result.length-1];if(lastToken&&lastToken.type==TEXT)lastToken.value+=text;else result.push(new Token(TEXT,text));break}var value=s.slice(lastIndex,index).trim();result.push(new Token(BINDING,value));lastIndex=index+2}}return result}function isCheckBoxOrRadioButton(element){return element.type==="radio"||element.type==="checkbox"}function bindOrDelegate(node,name,model,path,delegate){var delegateBinding;if(delegate&&typeof delegate=="function"){delegateBinding=delegate(path,model);if(delegateBinding){model=delegateBinding;path="value"}}node.bind(name,model,path)}function parseAndBind(node,text,name,model,delegate){var tokens=parseMustacheTokens(text);if(!tokens.length||tokens.length==1&&tokens[0].type==TEXT)return;if(tokens.length==1&&tokens[0].type==BINDING){bindOrDelegate(node,name,model,tokens[0].value,delegate);return}var replacementBinding=new CompoundBinding;for(var i=0;i<tokens.length;i++){var token=tokens[i];if(token.type==BINDING)bindOrDelegate(replacementBinding,i,model,token.value,delegate)}replacementBinding.combinator=function(values){var newValue="";for(var i=0;i<tokens.length;i++){var token=tokens[i];if(token.type===TEXT){newValue+=token.value}else{var value=values[i];if(value!==undefined)newValue+=value}}return newValue};node.bind(name,replacementBinding,"value")}function addAttributeBindings(element,model,delegate){assert(element);if(!element.attributes||!element.attributes.length)return;var attrs=[];for(var i=0;i<element.attributes.length;i++)attrs.push(element.attributes[i]);for(var i=0;i<attrs.length;i++)parseAndBind(element,attrs[i].value,attrs[i].name,model,delegate)}function addBindings(node,model,delegate){assert(node);if(node.nodeType===Node.ELEMENT_NODE){if(delegate&&isTemplate(node))node.bind(DELEGATE,delegate);addAttributeBindings(node,model,delegate)}else if(node.nodeType===Node.TEXT_NODE){parseAndBind(node,node.data,"textContent",model,delegate)}for(var child=node.firstChild;child;child=child.nextSibling)addBindings(child,model,delegate)}function removeAllBindingsRecursively(node){node.unbindAll();for(var child=node.firstChild;child;child=child.nextSibling){removeAllBindingsRecursively(child)}}function createDeepCloneAndDecorateTemplates(node){var clone=node.cloneNode(false);if(isTemplate(clone))HTMLTemplateElement.decorate(clone,node);for(var child=node.firstChild;child;child=child.nextSibling){clone.appendChild(createDeepCloneAndDecorateTemplates(child))}return clone}function removeChild(parent,child){removeTemplateInstanceRecord(child);if(isTemplate(child)){var templateIterator=templateIteratorTable.get(child);if(templateIterator){templateIterator.abandon();templateIteratorTable.delete(child)}}parent.removeChild(child);removeAllBindingsRecursively(child);child.model=child.delegate=undefined}function InstanceCursor(templateElement,opt_index){this.template_=templateElement;this.previousTerminator_=null;this.previousIndex_=-1;this.terminator_=templateElement;this.index_=0;if(!opt_index)return;while(opt_index-->0){this.next()}}function TemplateInstance(firstNode,lastNode,model){this.firstNode=firstNode;this.lastNode=lastNode;this.model=model}function addTemplateInstanceRecord(fragment,model){if(!fragment.firstChild)return;var instanceRecord=new TemplateInstance(fragment.firstChild,fragment.lastChild,model);var node=instanceRecord.firstNode;while(node){templateInstanceTable.set(node,instanceRecord);node=node.nextSibling}}function removeTemplateInstanceRecord(node){templateInstanceTable.delete(node)}var templateInstanceTable=new SideTable("templateInstance");Object.defineProperty(Node.prototype,"templateInstance",{get:function(){var instance=templateInstanceTable.get(this);return instance?instance:this.parentNode?this.parentNode.templateInstance:undefined}});InstanceCursor.prototype={next:function(){this.previousTerminator_=this.terminator_;this.previousIndex_=this.index_;this.index_++;while(this.index_>instanceTerminatorCount(this.terminator_)){this.index_-=instanceTerminatorCount(this.terminator_);this.terminator_=this.terminator_.nextSibling;if(this.terminator_.tagName==="TEMPLATE")this.index_+=instanceCount(this.terminator_)}},abandon:function(){assert(instanceCount(this.template_));assert(instanceTerminatorCount(this.terminator_));assert(this.index_);decrementInstanceTerminatorCount(this.terminator_);this.index_--},insert:function(model,delegate){assert(this.template_.parentNode);this.previousTerminator_=this.terminator_;this.previousIndex_=this.index_;this.index_++;var instance=createInstance(this.template_);addBindings(instance,model,delegate);addTemplateInstanceRecord(instance,model);this.terminator_=instance.lastChild||this.previousTerminator_;this.template_.parentNode.insertBefore(instance,this.previousTerminator_.nextSibling);incrementInstanceTerminatorCount(this.terminator_);if(this.terminator_!==this.previousTerminator_){while(instanceTerminatorCount(this.previousTerminator_)>this.previousIndex_){decrementInstanceTerminatorCount(this.previousTerminator_);incrementInstanceTerminatorCount(this.terminator_)}}},remove:function(){assert(this.previousIndex_!==-1);assert(this.previousTerminator_&&(this.previousIndex_>0||this.previousTerminator_===this.template_));assert(this.terminator_&&this.index_>0);assert(this.template_.parentNode);assert(instanceCount(this.template_));if(this.previousTerminator_===this.terminator_){assert(this.index_==this.previousIndex_+1);decrementInstanceTerminatorCount(this.terminator_);this.terminator_=this.template_;this.previousTerminator_=null;this.previousIndex_=-1;return}decrementInstanceTerminatorCount(this.terminator_);var parent=this.template_.parentNode;while(this.previousTerminator_.nextSibling!==this.terminator_){removeChild(parent,this.previousTerminator_.nextSibling)}removeChild(parent,this.terminator_);this.terminator_=this.previousTerminator_;this.index_=this.previousIndex_;this.previousTerminator_=null;this.previousIndex_=-1}};function Binding(model,path,changed){this.model=model;this.path=path;this.changed=changed;this.changed(Model.observePath(this.model,this.path,this.changed))}Binding.prototype={dispose:function(){Model.unobservePath(this.model,this.path,this.changed)},set value(newValue){Model.setValueAtPath(this.model,this.path,newValue)}};function CompoundBinding(combinator){this.bindings={};this.values={};this.value=undefined;this.size=0;this.combinator_=combinator;this.boundResolve=this.resolve.bind(this);this.diposed=false}CompoundBinding.prototype={set combinator(combinator){this.combinator_=combinator;this.scheduleResolve()},bind:function(name,model,path){this.unbind(name);this.size++;this.bindings[name]=new Binding(model,path,function(value){this.values[name]=value;this.scheduleResolve()}.bind(this))},unbind:function(name,suppressResolve){if(!this.bindings[name])return;this.size--;this.bindings[name].dispose();delete this.bindings[name];delete this.values[name];if(!suppressResolve)this.scheduleResolve()},scheduleResolve:function(){ensureScheduled(this.boundResolve)},resolve:function(){if(this.disposed)return;if(!this.combinator_)throw Error("CompoundBinding attempted to resolve without a combinator");this.value=this.combinator_(this.values)},dispose:function(){Object.keys(this.bindings).forEach(function(name){this.unbind(name,true)},this);this.disposed=true;this.value=undefined}};function TemplateIterator(templateElement,delegate){this.templateElement_=templateElement;this.instanceCount=0;this.iteratedValue=undefined;this.observing=false;this.boundHandleSplices=this.handleSplices.bind(this);this.inputs=new CompoundBinding(this.resolveInputs.bind(this));this.valueBinding=new Binding(this.inputs,"value",this.valueChanged.bind(this))}TemplateIterator.prototype={resolveInputs:function(values){if(IF in values&&!values[IF])return undefined;if(REPEAT in values)return values[REPEAT];if(BIND in values)return[values[BIND]]},valueChanged:function(value){this.clear();if(!Array.isArray(value))return;this.iteratedValue=value;Model.observeArray(this.iteratedValue,this.boundHandleSplices);this.observing=true;this.handleSplices([{index:0,addedCount:this.iteratedValue.length,removed:[]}])},handleSplices:function(splices){splices.forEach(function(splice){splice.removed.forEach(function(){var cursor=new InstanceCursor(this.templateElement_,splice.index+1);cursor.remove();this.instanceCount--},this);var addIndex=splice.index;for(;addIndex<splice.index+splice.addedCount;addIndex++){var cursor=new InstanceCursor(this.templateElement_,addIndex);cursor.insert(this.iteratedValue[addIndex],this.delegate);this.instanceCount++}},this)},unobserve:function(){if(!this.observing)return;Model.unobserveArray(this.iteratedValue,this.boundHandleSplices);this.observing=false},clear:function(){this.unobserve();this.iteratedValue=undefined;if(!this.instanceCount)return;for(var i=0;i<this.instanceCount;i++){var cursor=new InstanceCursor(this.templateElement_,1);cursor.remove()}this.instanceCount=0},abandon:function(){this.unobserve();this.valueBinding.dispose();this.inputs.dispose()}};var templateIteratorTable=new SideTable("templateIterator");function instanceCount(element){var templateIterator=templateIteratorTable.get(element);return templateIterator?templateIterator.instanceCount:0}function InstanceTerminatorCount(){this.instanceTerminatorCount_=0}InstanceTerminatorCount.prototype={instanceTerminatorCount:function(){return this.instanceTerminatorCount_},incrementInstanceTerminatorCount:function(){this.instanceTerminatorCount_++},decrementInstanceTerminatorCount:function(){this.instanceTerminatorCount_--}};var instanceTerminatorCountTable=new SideTable("instanceTerminatorCount");function ensureInstanceTerminatorCount(node){var count=instanceTerminatorCountTable.get(node);if(!count){count=new InstanceTerminatorCount;instanceTerminatorCountTable.set(node,count)}return count}function incrementInstanceTerminatorCount(node){ensureInstanceTerminatorCount(node).incrementInstanceTerminatorCount()}function decrementInstanceTerminatorCount(node){ensureInstanceTerminatorCount(node).decrementInstanceTerminatorCount()}function instanceTerminatorCount(node){var data=instanceTerminatorCountTable.get(node);return data?data.instanceTerminatorCount():0}global.CompoundBinding=CompoundBinding;HTMLTemplateElement.allTemplatesSelectors=allTemplatesSelectors})(this);(function(){var check=function(){Model.notifyChanges()};window.dirtyCheck=function(){logFlags.data&&console.group("Model.dirtyCheck()");check();logFlags.data&&console.groupEnd()};window.addEventListener("WebComponentsReady",function(){dirtyCheck();setInterval(check,125)})})();(function(){var WebComponents={preloadSelectors:["link[rel=component]","script[src]","link[rel=stylesheet]"],preload:function(inDocument,inNext){wc.cache=loader.cache;var nodes=inDocument.querySelectorAll(wc.preloadSelectors);nodes=Array.prototype.filter.call(nodes,function(n){return isDocumentLink(n)||!inMainDocument(n)});loader.loadAll(nodes,inNext,wc.eachPreload)},eachPreload:function(data,next,url,elt){if(isDocumentLink(elt)){var document=makeDocument(data,url);pathResolver.resolve(document);elt.component=elt.__resource=loader.cache[url]=document;WebComponents.preload(document,next)}else{if(isStylesheetLink(elt)){pathResolver.resolveSheet(elt)}next()}},getDocumentUrl:function(inDocument){return inDocument&&(inDocument._URL||inDocument.impl&&inDocument.impl._URL||inDocument.URL)||""}};var wc=WebComponents;wc.preloadSelectors=wc.preloadSelectors.join(",");function isDocumentLink(inElt){return inElt.localName==="link"&&inElt.getAttribute("rel")==="component"}function isDocumentLink(inElt){return isLinkRel(inElt,"component")}function isStylesheetLink(inElt){return isLinkRel(inElt,"stylesheet")}function isLinkRel(inElt,inRel){return inElt.localName==="link"&&inElt.getAttribute("rel")===inRel}function inMainDocument(inElt){return inElt.ownerDocument===document||inElt.ownerDocument.impl===document}function makeDocument(inHTML,inUrl){var doc=document.implementation.createHTMLDocument("component");doc.body.innerHTML=inHTML;doc._URL=inUrl;return doc}var loader={cache:{},loadAll:function(inNodes,inNext,inEach){if(!inNodes.length){inNext()}function head(inElt){var url=path.nodeUrl(inElt);var resource=loader.cache[url];if(resource){inElt.__resource=resource;tail()}else{xhr.load(url,function(err,resource,url){if(err){tail()}else{inElt.__resource=loader.cache[url]=resource;each(resource,tail,url,inElt)}})}}function tail(){if(!--inflight){inNext()}}var each=inEach||tail;var inflight=inNodes.length;forEach(inNodes,head)}};var path={nodeUrl:function(inNode){return path.resolveNodeUrl(inNode,path.hrefOrSrc(inNode))},hrefOrSrc:function(inNode){return inNode.getAttribute("href")||inNode.getAttribute("src")},resolveNodeUrl:function(inNode,inRelativeUrl){return this.resolveUrl(this.documentUrlFromNode(inNode),inRelativeUrl)},documentUrlFromNode:function(inNode){var url=wc.getDocumentUrl(inNode.ownerDocument);url=url.split("#")[0];return url},resolveUrl:function(inBaseUrl,inUrl){if(this.isAbsUrl(inUrl)){return inUrl}return this.compressUrl(this.urlToPath(inBaseUrl)+inUrl)},isAbsUrl:function(inUrl){return/(^data:)|(^http[s]?:)|(^\/)/.test(inUrl)},urlToPath:function(inBaseUrl){var parts=inBaseUrl.split("/");parts.pop();parts.push("");return parts.join("/")},compressUrl:function(inUrl){var parts=inUrl.split("/");for(var i=0,p;i<parts.length;i++){p=parts[i];if(p===".."){parts.splice(i-1,2);i-=2}}return parts.join("/")}};var pathResolver={resolve:function(inRoot){var docUrl=path.documentUrlFromNode(inRoot.body);pathResolver._resolve(inRoot.body,docUrl)},_resolve:function(inRoot,inUrl){pathResolver.resolveAttributes(inRoot,inUrl);pathResolver.resolveStyleElts(inRoot,inUrl);if(window.templateContent){var templates=inRoot.querySelectorAll("template");if(templates){forEach(templates,function(t){if(window.ShadowDOMPolyfill){t=ShadowDOMPolyfill.wrap(t)}pathResolver._resolve(templateContent(t),inUrl)})}}},resolveCssText:function(inCssText,inBaseUrl){return inCssText.replace(/url\([^)]*\)/g,function(inMatch){var urlPath=inMatch.replace(/["']/g,"").slice(4,-1);urlPath=path.resolveUrl(inBaseUrl,urlPath);return"url("+urlPath+")"})},resolveSheet:function(inSheet){var docUrl=path.nodeUrl(inSheet);inSheet.__resource=pathResolver.resolveCssText(inSheet.__resource,docUrl)},resolveStyleElts:function(inRoot,inUrl){var styles=inRoot.querySelectorAll("style");if(styles){forEach(styles,function(style){style.textContent=pathResolver.resolveCssText(style.textContent,inUrl)})}},resolveAttributes:function(inRoot,inUrl){var nodes=inRoot&&inRoot.querySelectorAll(URL_ATTRS_SELECTOR);if(nodes){forEach(nodes,function(n){URL_ATTRS.forEach(function(v){var attr=n.attributes[v];if(attr&&attr.value&&attr.value.search(URL_TEMPLATE_SEARCH)<0){attr.value=path.resolveUrl(inUrl,attr.value)}})})}}};var URL_ATTRS=["href","src","action"];var URL_ATTRS_SELECTOR=":not(link)["+URL_ATTRS.join("],[")+"]";var URL_TEMPLATE_SEARCH="{{.*}}";var xhr={async:true,ok:function(inRequest){return inRequest.status>=200&&inRequest.status<300||inRequest.status===304},load:function(url,next,nextContext){var request=new XMLHttpRequest;request.open("GET",url+"?"+Math.random(),xhr.async);request.addEventListener("readystatechange",function(e){if(request.readyState===4){next.call(nextContext,!xhr.ok(request)&&request,request.response,url)}});request.send()}};var forEach=Array.prototype.forEach.call.bind(Array.prototype.forEach);window.WebComponents=WebComponents;if(typeof window.CustomEvent!=="function"){window.CustomEvent=function(inType){var e=document.createEvent("HTMLEvents");e.initEvent(inType,true,true);return e}}window.addEventListener("load",function(){WebComponents.preload(document,function(){var doc=window.ShadowDOMPolyfill?ShadowDOMPolyfill.wrap(document):document;doc.body.dispatchEvent(new CustomEvent("WebComponentsLoaded",{bubbles:true}))})})})();(function(){function register(inName,inOptions){var definition=inOptions||{};if(!inName){throw new Error("Name argument must not be empty")}definition.name=inName;if(!definition.prototype){throw new Error("Options missing required prototype property")}definition.lifecycle=definition.lifecycle||{};definition.ancestry=ancestry(definition.extends);resolveTagName(definition);resolvePrototypeChain(definition);registerDefinition(inName,definition);definition.ctor=generateConstructor(definition);definition.ctor.prototype=definition.prototype;document.upgradeElements();return definition.ctor}function ancestry(inExtends){var extendee=registry[inExtends];if(extendee){return ancestry(extendee.extends).concat([extendee])}return[]}function resolveTagName(inDefinition){var baseTag=inDefinition.extends;for(var i=0,a;a=inDefinition.ancestry[i];i++){baseTag=a.is&&a.tag}inDefinition.tag=baseTag||inDefinition.name;if(baseTag){inDefinition.is=inDefinition.name}}function resolvePrototypeChain(inDefinition){if(window.WrapperElement&&!(inDefinition.prototype instanceof WrapperElement)||!Object.__proto__){if(inDefinition.is){var inst=domCreateElement(inDefinition.tag);var wrapperNative=Object.getPrototypeOf(inst);if(window.WrapperElement){inst=unwrap(inst)}var native=Object.getPrototypeOf(inst)}else{native=HTMLElement.prototype;if(window.WrapperElement){wrapperNative=WrapperHTMLUnknownElement.prototype}}}inDefinition.native=native;if(window.WrapperElement&&!(inDefinition.prototype instanceof WrapperElement)){if(Object.__proto__){var p=inDefinition.prototype,pp;while(true){pp=Object.getPrototypeOf(p);if(pp===native||pp==HTMLUnknownElement.prototype){break}p=pp}p.__proto__=wrapperNative}else{}}}function instantiate(inDefinition){return upgrade(domCreateElement(inDefinition.tag),inDefinition)}function upgrade(inElement,inDefinition){implement(inElement,inDefinition);if(inDefinition.is){inElement.setAttribute("is",inDefinition.is)}inElement.__upgraded__=true;upgradeElements(inElement);ready(inElement,inDefinition);return inElement}function implement(inElement,inDefinition){if(Object.__proto__){inElement.__proto__=inDefinition.prototype}else{if(!Object.__proto__){inElement.__proto__=inDefinition.prototype}customMixin(inElement,inDefinition.prototype,inDefinition.native)}}if(!console.group){console.group=function(m){console.log("[group] "+m)};console.groupEnd=function(){console.log("[end]")}}function customMixin(inTarget,inSrc,inNative){var used={};var p=inSrc;while(p!==inNative&&p!==HTMLUnknownElement.prototype){var keys=Object.getOwnPropertyNames(p);for(var i=0,k;k=keys[i];i++){if(!used[k]){Object.defineProperty(inTarget,k,Object.getOwnPropertyDescriptor(p,k));used[k]=1}}p=Object.getPrototypeOf(p)}}function ready(inElement,inDefinition){var readyCallback=inDefinition.lifecycle.readyCallback||inElement.readyCallback;if(readyCallback){readyCallback.call(inElement)}}var registry={};var registrySlctr="";function registerDefinition(inName,inDefinition){registry[inName]=inDefinition;registrySlctr+=registrySlctr?",":"";if(inDefinition.extends){registrySlctr+=inDefinition.tag+"[is="+inDefinition.is+"],"}registrySlctr+=inName}function generateConstructor(inDefinition){return function(){return instantiate(inDefinition)}}function createElement(inTag){var definition=registry[inTag];if(definition){return new definition.ctor}return domCreateElement(inTag)}function upgradeElement(inElement){if(!inElement.__upgraded__&&inElement.nodeType===Node.ELEMENT_NODE){var type=inElement.getAttribute("is")||inElement.localName;var definition=registry[type];return definition&&upgrade(inElement,definition)}}function upgradeElements(inRoot,inSlctr){var root=inRoot||document;if(root.querySelectorAll){var slctr=inSlctr||registrySlctr;if(slctr){var nodes=root.querySelectorAll(slctr);forEach(nodes,upgradeElement)}}}var forEach=Array.prototype.forEach.call.bind(Array.prototype.forEach);function mixin(inObj){var obj=inObj||{};for(var i=1;i<arguments.length;i++){var p=arguments[i];try{for(var n in p){copyProperty(n,p,obj)}}catch(x){}}return obj}function copyProperty(inName,inSource,inTarget){var pd=getPropertyDescriptor(inSource,inName);Object.defineProperty(inTarget,inName,pd)}function getPropertyDescriptor(inObject,inName){if(inObject){var pd=Object.getOwnPropertyDescriptor(inObject,inName);return pd||getPropertyDescriptor(Object.getPrototypeOf(inObject),inName)}}function watchDOM(inRoot){var mo=window.MutationObserver||window.WebKitMutationObserver;if(mo){var observer=new mo(function(mutations){mutations.forEach(function(mx){if(mx.type=="childList"){forEach(mx.addedNodes,function(n){if(window.ShadowDOMPolyfill){n=ShadowDOMPolyfill.wrap(n)}if(!upgradeElement(n)){upgradeElements(n)}})}})});if(window.ShadowDOMPolyfill&&inRoot.impl){inRoot=ShadowDOMPolyfill.unwrap(inRoot)}observer.observe(inRoot,{childList:true,subtree:true});return observer}}var domCreateElement=document.createElement.bind(document);document.register=document.webkitRegister||document.register;if(!document.register||flags.register!=="native"){document.register=register;
document.createElement=createElement;document.upgradeElement=upgradeElement;document.upgradeElements=upgradeElements;document.watchDOM=watchDOM}else{var nop=function(){};document.upgradeElement=nop;document.upgradeElements=nop;document.watchDOM=nop}window.mixin=mixin})();(function(){var HTMLElementElement=function(inElement){inElement.register=HTMLElementElement.prototype.register;parseElementElement(inElement);return inElement};HTMLElementElement.prototype={register:function(inMore){if(inMore){this.options.lifecycle=inMore.lifecycle;if(inMore.prototype){mixin(this.options.prototype,inMore.prototype)}}}};function parseElementElement(inElement){var options={name:"","extends":null};takeAttributes(inElement,options);var base=HTMLElement.prototype;if(options.extends){var archetype=document.createElement(options.extends);base=archetype.__proto__||Object.getPrototypeOf(archetype)}options.prototype=Object.create(base);inElement.options=options;var script=inElement.querySelector("script,scripts");if(script){executeComponentScript(script.textContent,inElement,options.name)}document.register(options.name,options)}function takeAttributes(inElement,inDictionary){for(var n in inDictionary){var a=inElement.attributes[n];if(a){inDictionary[n]=a.value}}}function executeComponentScript(inScript,inContext,inName){context=inContext;var owner=context.ownerDocument;var code="__componentScript('"+inName+"', function(){"+inScript+"});"+"\n//@ sourceURL="+(owner._URL||owner.URL)+"\n";eval(code)}var context;window.__componentScript=function(inName,inFunc){inFunc.call(context)};window.HTMLElementElement=HTMLElementElement})();(function(){var componentParser={selectors:["link[rel=component]","link[rel=stylesheet]","script[src]","script","style","element"],map:{link:"parseLink",script:"parseScript",element:"parseElement",style:"parseStyle"},parse:function(inDocument){if(inDocument){document.upgradeElements(inDocument);var elts=inDocument.querySelectorAll(cp.selectors);forEach(elts,function(e){cp[cp.map[e.localName]](e)})}},parseLink:function(inLinkElt){if(this.isDocumentLink(inLinkElt)){cp.parse(inLinkElt.__resource)}else{}},isDocumentLink:function(inElt){return inElt.localName==="link"&&inElt.getAttribute("rel")==="component"},parseScript:function(inScriptElt){if(inMainDocument(inScriptElt)){return}if(inScriptElt.parentNode.localName==="element"){return}var code=inScriptElt.__resource||inScriptElt.textContent;if(code){eval(code)}},parseStyle:function(inStyleElt){document.querySelector("head").appendChild(inStyleElt)},parseElement:function(inElementElt){new HTMLElementElement(inElementElt)}};var cp=componentParser;function inMainDocument(inElt){return inElt.ownerDocument===document||inElt.ownerDocument.impl===document}var forEach=Array.prototype.forEach.call.bind(Array.prototype.forEach);if(typeof window.CustomEvent!=="function"){window.CustomEvent=function(inType){var e=document.createEvent("HTMLEvents");e.initEvent(inType,true,true);return e}}function bootstrap(){setTimeout(function(){document.watchDOM(document.body);componentParser.parse(document);var doc=window.ShadowDOMPolyfill?ShadowDOMPolyfill.wrap(document):document;doc.body.dispatchEvent(new CustomEvent("WebComponentsReady",{bubbles:true}))},0)}if(window.WebComponents){document.addEventListener("WebComponentsLoaded",bootstrap)}else{window.addEventListener("load",bootstrap)}})();(function(){function selector(v){return'[touch-action="'+v+'"]'}function rule(v){return"{ -ms-touch-action: "+v+"; touch-action: "+v+"; }"}var attrib2css=["none","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["scroll","pan-x pan-y","pan-y pan-x"]}];var styles="";attrib2css.forEach(function(r){if(String(r)===r){styles+=selector(r)+rule(r)}else{styles+=r.selectors.map(selector)+rule(r.rule)}});var el=document.createElement("style");el.textContent=styles;document.head.appendChild(el)})();function PointerEvent(inType,inDict){var props={bubbles:false,cancelable:false,view:null,detail:null,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,button:0,buttons:undefined,which:0,relatedTarget:null,pointerId:0,width:0,height:0,pressure:0,tiltX:0,tiltY:0,pointerType:"",hwTimestamp:0,isPrimary:false};for(var p in inDict){if(p in props){props[p]=inDict[p]}}var b=props.which?props.button:-1;var pressure;if(props.pressure){pressure=props.pressure}else if(props.buttons!==undefined){pressure=props.buttons?.5:0}else{pressure=b>-1?.5:0}var e;if(document.implementation.hasFeature("MouseEvent","4.0")){e=new MouseEvent(inType,inDict)}else{e=document.createEvent("MouseEvent");e.initMouseEvent(inType,props.bubbles,props.cancelable,props.view,props.detail,props.screenX,props.screenY,props.clientX,props.clientY,props.ctrlKey,props.altKey,props.shiftKey,props.metaKey,b,props.relatedTarget)}Object.defineProperties(e,{pointerId:{value:props.pointerId,enumerable:true},width:{value:props.width,enumerable:true},height:{value:props.height,enumerable:true},pressure:{value:pressure,enumerable:true},tiltX:{value:props.tiltX,enumerable:true},tiltY:{value:props.tiltY,enumerable:true},pointerType:{value:props.pointerType,enumerable:true},hwTimestamp:{value:props.hwTimestamp,enumerable:true},isPrimary:{value:props.isPrimary,enumerable:true}});return e}(function(scope){scope=scope||{};function PointerMap(){this.ids=[];this.pointers=[]}PointerMap.prototype={set:function(inId,inEvent){var i=this.ids.indexOf(inId);if(i>-1){this.pointers[i]=inEvent}else{this.ids.push(inId);this.pointers.push(inEvent)}},has:function(inId){return this.ids.indexOf(inId)>-1},"delete":function(inId){var i=this.ids.indexOf(inId);if(i>-1){this.ids.splice(i,1);this.pointers.splice(i,1)}},get:function(inId){var i=this.ids.indexOf(inId);return this.pointers[i]},item:function(inIndex){return this.pointers[inIndex]},get size(){return this.pointers.length}};scope.PointerMap=PointerMap;window.PointerEventsPolyfill=scope})(window.PointerEventsPolyfill);(function(scope){var SideTable;if(typeof WeakMap!=="undefined"&&navigator.userAgent.indexOf("Firefox/")<0){SideTable=WeakMap}else{SideTable=function(name){this.name="__$"+name+"$__"};SideTable.prototype={set:function(key,value){Object.defineProperty(key,this.name,{value:value,writable:true})},get:function(key){return key[this.name]}}}scope.SideTable=SideTable})(window.PointerEventsPolyfill);(function(scope){var dispatcher={targets:new scope.SideTable("target"),handledEvents:new scope.SideTable("pointer"),scrollType:new scope.SideTable("scrollType"),pointermap:new scope.PointerMap,events:[],eventMap:{},eventSources:{},registerSource:function(inName,inSource){var s=inSource;var newEvents=s.events;if(newEvents){this.events=this.events.concat(newEvents);newEvents.forEach(function(e){if(s[e]){this.eventMap[e]=s[e].bind(s)}},this);this.eventSources[inName]=s}},registerTarget:function(inTarget,inAxis){this.scrollType.set(inTarget,inAxis||"none");this.listen(this.events,inTarget,this.boundHandler)},unregisterTarget:function(inTarget){this.scrollType.set(inTarget,null);this.unlisten(this.events,inTarget,this.boundHandler)},down:function(inEvent){this.fireEvent("pointerdown",inEvent)},move:function(inEvent){this.fireEvent("pointermove",inEvent)},up:function(inEvent){this.fireEvent("pointerup",inEvent)},enter:function(inEvent){this.fireEvent("pointerenter",inEvent)},leave:function(inEvent){this.fireEvent("pointerleave",inEvent)},over:function(inEvent){this.fireEvent("pointerover",inEvent)},out:function(inEvent){this.fireEvent("pointerout",inEvent)},cancel:function(inEvent){this.fireEvent("pointercancel",inEvent)},eventHandler:function(inEvent){if(this.handledEvents.get(inEvent)){return}var type=inEvent.type;var fn=this.eventMap&&this.eventMap[type];if(fn){fn(inEvent)}this.handledEvents.set(inEvent,true)},listen:function(inEvents,inTarget,inListener){inEvents.forEach(function(e){this.addEvent(e,inListener,false,inTarget)},this)},unlisten:function(inEvents,inTarget,inListener){inEvents.forEach(function(e){this.removeEvent(e,inListener,false,inTarget)},this)},addEvent:function(inEventName,inEventHandler,inCapture,inTarget){inTarget.addEventListener(inEventName,inEventHandler,inCapture)},removeEvent:function(inEventName,inEventHandler,inCapture,inTarget){inTarget.removeEventListener(inEventName,inEventHandler,inCapture)},makeEvent:function(inType,inEvent){var e=new PointerEvent(inType,inEvent);this.targets.set(e,this.targets.get(inEvent)||inEvent.target);return e},fireEvent:function(inType,inEvent){var e=this.makeEvent(inType,inEvent);return this.dispatchEvent(e)},cloneEvent:function(inEvent){var eventCopy={};for(var n in inEvent){eventCopy[n]=inEvent[n]}return eventCopy},getTarget:function(inEvent){if(this.captureInfo){if(this.captureInfo.id===inEvent.pointerId){return this.captureInfo.target}}return this.targets.get(inEvent)},setCapture:function(inPointerId,inTarget){if(this.captureInfo){this.releaseCapture(this.captureInfo.id)}this.captureInfo={id:inPointerId,target:inTarget};var e=new PointerEvent("gotpointercapture",{bubbles:true});this.implicitRelease=this.releaseCapture.bind(this,inPointerId);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);this.targets.set(e,inTarget);this.asyncDispatchEvent(e)},releaseCapture:function(inPointerId){if(this.captureInfo&&this.captureInfo.id===inPointerId){var e=new PointerEvent("lostpointercapture",{bubbles:true});var t=this.captureInfo.target;this.captureInfo=null;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);this.targets.set(e,t);this.asyncDispatchEvent(e)}},dispatchEvent:function(inEvent){var t=this.getTarget(inEvent);if(t){return t.dispatchEvent(inEvent)}},asyncDispatchEvent:function(inEvent){setTimeout(this.dispatchEvent.bind(this,inEvent),0)}};dispatcher.boundHandler=dispatcher.eventHandler.bind(dispatcher);scope.dispatcher=dispatcher})(window.PointerEventsPolyfill);(function(scope){var dispatcher=scope.dispatcher;var forEach=Array.prototype.forEach.call.bind(Array.prototype.forEach);var map=Array.prototype.map.call.bind(Array.prototype.map);var installer={ATTRIB:"touch-action",SELECTOR:"[touch-action]",EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|scroll$/,OBSERVER_INIT:{subtree:true,childList:true,attributes:true,attributeFilter:["touch-action"]},watchSubtree:function(inScope){observer.observe(inScope,this.OBSERVER_INIT)},enableOnSubtree:function(inScope){var scope=inScope||document;this.watchSubtree(inScope);if(scope===document&&document.readyState!=="complete"){this.installOnLoad()}else{this.installNewSubtree(scope)}},installNewSubtree:function(inScope){forEach(this.findElements(inScope),this.addElement,this)},findElements:function(inScope){var scope=inScope||document;if(scope.querySelectorAll){return scope.querySelectorAll(this.SELECTOR)}return[]},touchActionToScrollType:function(inTouchAction){var t=inTouchAction;if(t===this.EMITTER){return"none"}else if(t===this.XSCROLLER){return"X"}else if(t===this.YSCROLLER){return"Y"}else if(this.SCROLLER.exec(t)){return"XY"}},removeElement:function(inEl){dispatcher.unregisterTarget(inEl);var s=scope.targetFinding.shadow(inEl);if(s){dispatcher.unregisterTarget(s)}},addElement:function(inEl){var a=inEl.getAttribute&&inEl.getAttribute(this.ATTRIB);var st=this.touchActionToScrollType(a);if(st){dispatcher.registerTarget(inEl,st);var s=scope.targetFinding.shadow(inEl);if(s){dispatcher.registerTarget(s,st)}}},elementChanged:function(inEl){this.removeElement(inEl);this.addElement(inEl)},concatLists:function(inAccum,inList){for(var i=0,l=inList.length,o;i<l&&(o=inList[i]);i++){inAccum.push(o)}return inAccum},installOnLoad:function(){document.addEventListener("DOMContentLoaded",this.installNewSubtree.bind(this,document))},flattenMutationTree:function(inNodes){var tree=map(inNodes,this.findElements,this);tree.push(inNodes);return tree.reduce(this.concatLists,[])},mutationWatcher:function(inMutations){inMutations.forEach(this.mutationHandler,this)},mutationHandler:function(inMutation){var m=inMutation;if(m.type==="childList"){var added=this.flattenMutationTree(m.addedNodes);added.forEach(this.addElement,this);var removed=this.flattenMutationTree(m.removedNodes);removed.forEach(this.removeElement,this)}else if(m.type==="attributes"){this.elementChanged(m.target)}}};var boundWatcher=installer.mutationWatcher.bind(installer);scope.installer=installer;scope.register=installer.enableOnSubtree.bind(installer);scope.setTouchAction=function(inEl,inTouchAction){var st=this.touchActionToScrollType(inTouchAction);if(st){dispatcher.registerTarget(inEl,st)}else{dispatcher.unregisterTarget(inEl)}}.bind(installer);var MO=window.MutationObserver||window.WebKitMutationObserver;if(!MO){installer.watchSubtree=function(){console.warn("PointerEventsPolyfill: MutationObservers not found, touch-action will not be dynamically detected")}}else{var observer=new MO(boundWatcher)}})(window.PointerEventsPolyfill);(function(scope){var target={shadow:function(inEl){if(inEl){var s=inEl.webkitShadowRoot||inEl.shadowRoot;if(s&&s.elementFromPoint){return s}}},searchRoot:function(inRoot,x,y){if(inRoot){var t=inRoot.elementFromPoint(x,y);var st,sr,os;sr=this.shadow(t);while(sr){st=sr.elementFromPoint(x,y);if(!st){os=sr.querySelector("shadow");sr=os&&os.olderShadowRoot}else{var ssr=this.shadow(st);return this.searchRoot(ssr,x,y)||st}}return t}},findTarget:function(inEvent){var x=inEvent.clientX,y=inEvent.clientY;return this.searchRoot(document,x,y)}};scope.targetFinding=target;scope.findTarget=target.findTarget.bind(target)})(window.PointerEventsPolyfill);(function(scope){var dispatcher=scope.dispatcher;var installer=scope.installer;var findTarget=scope.findTarget;var pointermap=dispatcher.pointermap;var touchMap=Array.prototype.map.call.bind(Array.prototype.map);var DEDUP_TIMEOUT=2500;var DEDUP_DIST=25;var touchEvents={events:["touchstart","touchmove","touchend","touchcancel"],POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(inTouch){return this.firstTouch===inTouch.identifier},setPrimaryTouch:function(inTouch){if(this.firstTouch===null){this.firstTouch=inTouch.identifier;this.firstXY={X:inTouch.clientX,Y:inTouch.clientY};this.scrolling=false}},removePrimaryTouch:function(inTouch){if(this.isPrimaryTouch(inTouch)){this.firstTouch=null;this.firstXY=null}},touchToPointer:function(inTouch){var e=dispatcher.cloneEvent(inTouch);e.pointerId=inTouch.identifier+2;e.target=findTarget(e);e.bubbles=true;e.cancelable=true;e.button=0;e.buttons=1;e.isPrimary=this.isPrimaryTouch(inTouch);e.pointerType=this.POINTER_TYPE;return e},processTouches:function(inEvent,inFunction){var tl=inEvent.changedTouches;var pointers=touchMap(tl,this.touchToPointer,this);pointers.forEach(inFunction,this)},shouldScroll:function(inEvent){if(this.firstXY){var ret;var scrollAxis=dispatcher.scrollType.get(inEvent.currentTarget);if(scrollAxis==="none"){ret=false}else if(scrollAxis==="XY"){ret=true}else{var t=inEvent.changedTouches[0];var a=scrollAxis;var oa=scrollAxis==="Y"?"X":"Y";var da=Math.abs(t["client"+a]-this.firstXY[a]);var doa=Math.abs(t["client"+oa]-this.firstXY[oa]);ret=da>=doa}this.firstXY=null;return ret}},findTouch:function(inTL,inId){for(var i=0,l=inTL.length,t;i<l&&(t=inTL[i]);i++){if(t.identifier===inId){return true}}},vacuumTouches:function(inEvent){var tl=inEvent.touches;if(pointermap.size>=tl.length){var d=[];pointermap.ids.forEach(function(i){if(i!==1&&!this.findTouch(tl,i-2)){var p=pointermap.get(i).out;d.push(this.touchToPointer(p))}},this);d.forEach(this.cancelOut,this)}},touchstart:function(inEvent){this.vacuumTouches(inEvent);this.setPrimaryTouch(inEvent.changedTouches[0]);if(!this.scrolling){this.processTouches(inEvent,this.overDown)}},overDown:function(inPointer){var p=pointermap.set(inPointer.pointerId,{target:inPointer.target,out:inPointer,outTarget:inPointer.target});dispatcher.over(inPointer);dispatcher.down(inPointer)},touchmove:function(inEvent){if(!this.scrolling){if(this.shouldScroll(inEvent)){this.scrolling=true;this.touchcancel(inEvent)}else{inEvent.preventDefault();this.processTouches(inEvent,this.moveOverOut)}}},moveOverOut:function(inPointer){var event=inPointer;var pointer=pointermap.get(event.pointerId);var outEvent=pointer.out;var outTarget=pointer.outTarget;dispatcher.move(event);if(outEvent&&outTarget!==event.target){outEvent.relatedTarget=event.target;event.relatedTarget=outTarget;outEvent.target=outTarget;dispatcher.out(outEvent);dispatcher.over(event)}pointer.out=event;pointer.outTarget=event.target},touchend:function(inEvent){this.dedupSynthMouse(inEvent);this.processTouches(inEvent,this.upOut)},upOut:function(inPointer){if(!this.scrolling){dispatcher.up(inPointer);dispatcher.out(inPointer)}this.cleanUpPointer(inPointer)},touchcancel:function(inEvent){this.processTouches(inEvent,this.cancelOut)},cancelOut:function(inPointer){dispatcher.cancel(inPointer);dispatcher.out(inPointer);this.cleanUpPointer(inPointer)},cleanUpPointer:function(inPointer){pointermap.delete(inPointer.pointerId);this.removePrimaryTouch(inPointer)},dedupSynthMouse:function(inEvent){var lts=mouseEvents.lastTouches;var t=inEvent.changedTouches[0];if(this.isPrimaryTouch(t)){var lt={x:t.clientX,y:t.clientY};lts.push(lt);var fn=function(lts,lt){var i=lts.indexOf(lt);if(i>-1){lts.splice(i,1)}}.bind(null,lts,lt);setTimeout(fn,DEDUP_TIMEOUT)}}};var mouseEvents={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],global:["mousedown","mouseup","mouseover","mouseout"],lastTouches:[],mouseHandler:dispatcher.eventHandler.bind(dispatcher),isEventSimulatedFromTouch:function(inEvent){var lts=this.lastTouches;var x=inEvent.clientX,y=inEvent.clientY;for(var i=0,l=lts.length,t;i<l&&(t=lts[i]);i++){var dx=Math.abs(x-t.x),dy=Math.abs(y-t.y);if(dx<=DEDUP_DIST&&dy<=DEDUP_DIST){return true}}},prepareEvent:function(inEvent){var e=dispatcher.cloneEvent(inEvent);e.pointerId=this.POINTER_ID;e.isPrimary=true;e.pointerType=this.POINTER_TYPE;return e},mousedown:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var p=pointermap.has(this.POINTER_ID);if(p){this.cancel(inEvent);p=false}if(!p){var e=this.prepareEvent(inEvent);pointermap.set(this.POINTER_ID,inEvent);dispatcher.down(e);dispatcher.listen(this.global,document,this.mouseHandler)}}},mousemove:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var e=this.prepareEvent(inEvent);dispatcher.move(e)}},mouseup:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var p=pointermap.get(this.POINTER_ID);if(p&&p.button===inEvent.button){var e=this.prepareEvent(inEvent);dispatcher.up(e);this.cleanupMouse()}}},mouseover:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var e=this.prepareEvent(inEvent);dispatcher.over(e)}},mouseout:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var e=this.prepareEvent(inEvent);dispatcher.out(e)}},cancel:function(inEvent){var e=this.prepareEvent(inEvent);dispatcher.cancel(e);this.cleanupMouse()},cleanupMouse:function(){pointermap.delete(this.POINTER_ID);dispatcher.unlisten(this.global,document,this.mouseHandler)}};var msEvents={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(inEvent){var e=dispatcher.cloneEvent(inEvent);e.pointerType=this.POINTER_TYPES[inEvent.pointerType];return e},MSPointerDown:function(inEvent){var e=this.prepareEvent(inEvent);dispatcher.down(e)},MSPointerMove:function(inEvent){var e=this.prepareEvent(inEvent);dispatcher.move(e)},MSPointerUp:function(inEvent){var e=this.prepareEvent(inEvent);dispatcher.up(e)},MSPointerOut:function(inEvent){var e=this.prepareEvent(inEvent);dispatcher.out(e)},MSPointerOver:function(inEvent){var e=this.prepareEvent(inEvent);dispatcher.over(e)},MSPointerCancel:function(inEvent){var e=this.prepareEvent(inEvent);dispatcher.cancel(e)},MSLostPointerCapture:function(inEvent){var e=dispatcher.makeEvent("lostpointercapture",inEvent);dispatcher.dispatchEvent(e)},MSGotPointerCapture:function(inEvent){var e=dispatcher.makeEvent("gotpointercapture",inEvent);dispatcher.dispatchEvent(e)}};if(window.navigator.pointerEnabled===undefined){if(window.navigator.msPointerEnabled){var tp=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:tp,enumerable:true});dispatcher.registerSource("ms",msEvents);dispatcher.registerTarget(document)}else{dispatcher.registerSource("mouse",mouseEvents);if("ontouchstart"in window){dispatcher.registerSource("touch",touchEvents)}installer.enableOnSubtree(document);dispatcher.listen(["mousemove"],document)}Object.defineProperty(window.navigator,"pointerEnabled",{value:true,enumerable:true})}})(window.PointerEventsPolyfill);(function(scope){var dispatcher=scope.dispatcher;var n=window.navigator;var s,r;var isDown=function(inId){if(!dispatcher.pointermap.has(inId)){throw new Error("InvalidPointerId")}return true};if(n.msPointerEnabled){s=Element.prototype.msSetPointerCapture;r=Element.prototype.msReleasePointerCapture}else{s=function setPointerCapture(inPointerId){if(isDown(inPointerId)){dispatcher.setCapture(inPointerId,this)}};r=function releasePointerCapture(inPointerId){if(isDown(inPointerId)){dispatcher.releaseCapture(inPointerId,this)}}}if(!Element.prototype.setPointerCapture){Object.defineProperties(Element.prototype,{setPointerCapture:{value:s},releasePointerCapture:{value:r}})}})(window.PointerEventsPolyfill);